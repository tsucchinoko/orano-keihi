name: MacOS Release Build

# mainãƒ–ãƒ©ãƒ³ãƒãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«ãƒˆãƒªã‚¬ãƒ¼
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: full
  RUST_LOG: debug

jobs:
  build-macos:
    # MacOSãƒ©ãƒ³ãƒŠãƒ¼ç’°å¢ƒã®è¨­å®š
    runs-on: macos-latest
    
    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ãƒ“ãƒ«ãƒ‰æƒ…å ±ã®å‡ºåŠ›
      run: |
        echo "ãƒ“ãƒ«ãƒ‰é–‹å§‹: $(date)"
        echo "ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥: ${{ github.sha }}"
        echo "ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}"
        
    # Node.js/Denoç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    - name: Denoã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: denoland/setup-deno@v2
      with:
        deno-version: v2.x
        
    - name: Denoã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è¨­å®š
      uses: actions/cache@v4
      with:
        path: |
          ~/.cache/deno
          ~/.deno
        key: ${{ runner.os }}-deno-${{ hashFiles('**/deno.lock') }}
        restore-keys: |
          ${{ runner.os }}-deno-
          
    - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        echo "Denoã®ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèªä¸­..."
        deno --version
        echo "åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã‚’ç¢ºèª..."
        deno task --help || echo "ã‚¿ã‚¹ã‚¯ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤ºã«å¤±æ•—"
        
    - name: ãƒ“ãƒ«ãƒ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ¨©é™è¨­å®š
      run: chmod +x .github/scripts/build-helper.sh
      
    - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œ
      id: frontend-build
      run: |
        # ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
        source .github/scripts/build-helper.sh
        build_frontend
      continue-on-error: false
      
    - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã®è©³ç´°ãƒ­ã‚°
      if: failure() && steps.frontend-build.outcome == 'failure'
      run: |
        echo "=== ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®è©³ç´° ==="
        echo "ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°:"
        cat frontend-build.log || echo "ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== package.jsonã®ç¢ºèª ==="
        cat package.json || echo "package.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== Denoã®è¨­å®šç¢ºèª ==="
        cat deno.json || echo "deno.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ç¢ºèª ==="
        find . -name "*.svelte" -o -name "*.ts" -o -name "*.js" | head -20
        
    # Rustç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    - name: Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: stable
        
    - name: Tauri CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      uses: nick-fields/retry@v3
      with:
        timeout_minutes: 10
        max_attempts: 3
        retry_on: error
        command: |
          cargo install tauri-cli --version "^2.0" --locked
        
    - name: Cargoã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è¨­å®š
      uses: actions/cache@v4
      with:
        path: |
          ~/.cargo/bin/
          ~/.cargo/registry/index/
          ~/.cargo/registry/cache/
          ~/.cargo/git/db/
          src-tauri/target/
        key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-cargo-
          
    - name: Tauriãƒ“ãƒ«ãƒ‰ç’°å¢ƒã®æº–å‚™
      id: tauri-setup
      run: |
        echo "Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª..."
        rustc --version
        cargo --version
        echo "Tauriãƒ“ãƒ«ãƒ‰ç’°å¢ƒã‚’æº–å‚™ä¸­..."
        # Tauriã®ä¾å­˜é–¢ä¿‚ã‚’äº‹å‰ã«ãƒã‚§ãƒƒã‚¯
        cd src-tauri
        echo "Cargo.tomlã®ç¢ºèª..."
        cat Cargo.toml
        echo "ä¾å­˜é–¢ä¿‚ã®ãƒã‚§ãƒƒã‚¯..."
        cargo check 2>&1 | tee ../tauri-setup.log
        echo "Tauriãƒ“ãƒ«ãƒ‰ç’°å¢ƒã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸ"
      continue-on-error: false
      
    - name: Tauriã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¤±æ•—æ™‚ã®è©³ç´°ãƒ­ã‚°
      if: failure() && steps.tauri-setup.outcome == 'failure'
      run: |
        echo "=== Tauriã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¤±æ•—ã®è©³ç´° ==="
        echo "ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ­ã‚°:"
        cat tauri-setup.log || echo "ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== Cargo.lockã®ç¢ºèª ==="
        cat src-tauri/Cargo.lock | head -50 || echo "Cargo.lockãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== tauri.conf.jsonã®ç¢ºèª ==="
        cat src-tauri/tauri.conf.json || echo "tauri.conf.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        
    # Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
    - name: Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
      id: tauri-build
      run: |
        # ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦Tauriãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
        source .github/scripts/build-helper.sh
        build_tauri
      continue-on-error: false
      
    - name: Tauriãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã®è©³ç´°ãƒ­ã‚°
      if: failure() && steps.tauri-build.outcome == 'failure'
      run: |
        echo "=== Tauriãƒ“ãƒ«ãƒ‰å¤±æ•—ã®è©³ç´° ==="
        echo "ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°:"
        cat tauri-build.log || echo "ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã®è©³ç´° ==="
        find src-tauri/target -name "*.log" -type f -exec echo "=== {} ===" \; -exec cat {} \; || echo "è¿½åŠ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª ==="
        env | grep -E "(RUST|CARGO|TAURI)" || echo "é–¢é€£ç’°å¢ƒå¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        
    - name: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ç¢ºèª
      id: artifact-check
      run: |
        # ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦æˆæœç‰©ã‚’ç¢ºèª
        source .github/scripts/build-helper.sh
        if verify_artifacts; then
          echo "artifact_exists=true" >> $GITHUB_OUTPUT
        else
          echo "artifact_exists=false" >> $GITHUB_OUTPUT
          exit 1
        fi
      continue-on-error: false
        
    # dmgãƒ•ã‚¡ã‚¤ãƒ«ã®æˆæœç‰©ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    - name: dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      if: steps.artifact-check.outputs.artifact_exists == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: macos-dmg-${{ github.sha }}
        path: src-tauri/target/release/bundle/dmg/*.dmg
        if-no-files-found: error
        retention-days: 30
        
    - name: æˆæœç‰©ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã®è©³ç´°ãƒ­ã‚°
      if: failure() && steps.artifact-check.outputs.artifact_exists == 'false'
      run: |
        echo "=== æˆæœç‰©ç”Ÿæˆå¤±æ•—ã®è©³ç´° ==="
        echo "ãƒãƒ³ãƒ‰ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºèª..."
        find src-tauri/target/release -type f -name "*" | grep -E "\.(app|dmg|pkg)$" || echo "MacOSç”¨æˆæœç‰©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        echo "=== ãƒ“ãƒ«ãƒ‰è¨­å®šã®ç¢ºèª ==="
        cat src-tauri/tauri.conf.json | grep -A 20 -B 5 "bundle" || echo "ãƒãƒ³ãƒ‰ãƒ«è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        
    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®åé›†ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    - name: ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã®åé›†
      if: always()  # æˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œ
      run: |
        echo "ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’åé›†ä¸­..."
        mkdir -p build-logs
        
        # å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åé›†
        cp frontend-build.log build-logs/ 2>/dev/null || echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ãªã—"
        cp tauri-setup.log build-logs/ 2>/dev/null || echo "Tauriã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ­ã‚°ãªã—"
        cp tauri-build.log build-logs/ 2>/dev/null || echo "Tauriãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ãªã—"
        
        # ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’åé›†ï¼ˆæˆåŠŸæ™‚ã®ã¿ï¼‰
        cp release-notes.md build-logs/ 2>/dev/null || echo "ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãªã—"
        
        # ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã‚’è¨˜éŒ²
        echo "=== ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± ===" > build-logs/system-info.log
        echo "æ—¥æ™‚: $(date)" >> build-logs/system-info.log
        echo "OS: $(uname -a)" >> build-logs/system-info.log
        echo "Rust: $(rustc --version)" >> build-logs/system-info.log
        echo "Cargo: $(cargo --version)" >> build-logs/system-info.log
        echo "Deno: $(deno --version)" >> build-logs/system-info.log
        echo "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡:" >> build-logs/system-info.log
        df -h >> build-logs/system-info.log
        echo "ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:" >> build-logs/system-info.log
        vm_stat >> build-logs/system-info.log 2>/dev/null || echo "ãƒ¡ãƒ¢ãƒªæƒ…å ±å–å¾—å¤±æ•—" >> build-logs/system-info.log
        
        # Cargoã®è©³ç´°ãƒ­ã‚°ã‚’åé›†
        find src-tauri/target -name "*.log" -type f -exec cp {} build-logs/ \; 2>/dev/null || echo "è¿½åŠ Cargoãƒ­ã‚°ãªã—"
        
        # ãƒªãƒªãƒ¼ã‚¹æƒ…å ±ã‚’è¨˜éŒ²ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒã®å ´åˆï¼‰
        if [ "${{ github.ref_name }}" = "main" ] && [ "${{ github.event_name }}" = "push" ]; then
          echo "=== ãƒªãƒªãƒ¼ã‚¹æƒ…å ± ===" > build-logs/release-info.log
          echo "ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°: ${{ steps.version.outputs.release_tag || 'N/A' }}" >> build-logs/release-info.log
          echo "ãƒªãƒªãƒ¼ã‚¹å: ${{ steps.version.outputs.release_name || 'N/A' }}" >> build-logs/release-info.log
          echo "dmgãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.dmg-path.outputs.dmg_name || 'N/A' }}" >> build-logs/release-info.log
          echo "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${{ steps.dmg-path.outputs.dmg_size || 'N/A' }}" >> build-logs/release-info.log
          echo "ãƒªãƒªãƒ¼ã‚¹ä½œæˆ: ${{ steps.check-release.outputs.release_exists == 'false' && 'æˆåŠŸ' || 'æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹å­˜åœ¨' }}" >> build-logs/release-info.log
        fi
        
        echo "ãƒ­ã‚°åé›†å®Œäº†"
        ls -la build-logs/
        
    - name: ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: build-logs-${{ github.sha }}
        path: build-logs/
        retention-days: 7
        
    - name: ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã®é€šçŸ¥
      if: failure()
      run: |
        echo "::error title=ãƒ“ãƒ«ãƒ‰å¤±æ•—::MacOSãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ"
        echo "::error::è©³ç´°ãªãƒ­ã‚°ã¯build-logs-${{ github.sha }}æˆæœç‰©ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        echo "::error::å¤±æ•—ã—ãŸã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}"
        echo "::error::å¤±æ•—ã—ãŸãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}"
        
        # GitHub Issues APIã‚’ä½¿ç”¨ã—ãŸé€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        if [ "${{ github.event_name }}" = "push" ] && [ "${{ github.ref_name }}" = "main" ]; then
          echo "mainãƒ–ãƒ©ãƒ³ãƒã§ã®ãƒ“ãƒ«ãƒ‰å¤±æ•—ã‚’æ¤œå‡ºã—ã¾ã—ãŸ"
          echo "::warning::mainãƒ–ãƒ©ãƒ³ãƒã§ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è‡³æ€¥ç¢ºèªãŒå¿…è¦ã§ã™ã€‚"
        fi
        
    # GitHubãƒªãƒªãƒ¼ã‚¹è‡ªå‹•åŒ–
    - name: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å–å¾—
      if: success() && github.ref_name == 'main' && github.event_name == 'push'
      id: version
      run: |
        # package.jsonã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
        PACKAGE_VERSION=$(cat package.json | grep '"version"' | head -1 | awk -F: '{ print $2 }' | sed 's/[",]//g' | tr -d ' ')
        echo "package_version=$PACKAGE_VERSION" >> $GITHUB_OUTPUT
        
        # Tauriè¨­å®šã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
        TAURI_VERSION=$(cat src-tauri/tauri.conf.json | grep '"version"' | head -1 | awk -F: '{ print $2 }' | sed 's/[",]//g' | tr -d ' ')
        echo "tauri_version=$TAURI_VERSION" >> $GITHUB_OUTPUT
        
        # ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’ç”Ÿæˆï¼ˆvæ¥é ­è¾ä»˜ãï¼‰
        RELEASE_TAG="v$PACKAGE_VERSION"
        echo "release_tag=$RELEASE_TAG" >> $GITHUB_OUTPUT
        
        # ãƒªãƒªãƒ¼ã‚¹åã‚’ç”Ÿæˆ
        RELEASE_NAME="ã‚ªãƒ©ã®çµŒè²»ã ã‚¾ $RELEASE_TAG"
        echo "release_name=$RELEASE_NAME" >> $GITHUB_OUTPUT
        
        echo "ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±:"
        echo "Package Version: $PACKAGE_VERSION"
        echo "Tauri Version: $TAURI_VERSION"
        echo "Release Tag: $RELEASE_TAG"
        echo "Release Name: $RELEASE_NAME"
        
    - name: dmgãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å–å¾—
      if: success() && github.ref_name == 'main' && github.event_name == 'push'
      id: dmg-path
      run: |
        # dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å–å¾—
        DMG_PATH=$(find src-tauri/target/release/bundle/dmg -name "*.dmg" -type f | head -1)
        if [ -z "$DMG_PATH" ]; then
          echo "::error::dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        
        DMG_NAME=$(basename "$DMG_PATH")
        echo "dmg_path=$DMG_PATH" >> $GITHUB_OUTPUT
        echo "dmg_name=$DMG_NAME" >> $GITHUB_OUTPUT
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å–å¾—
        DMG_SIZE=$(ls -lh "$DMG_PATH" | awk '{print $5}')
        echo "dmg_size=$DMG_SIZE" >> $GITHUB_OUTPUT
        
        echo "dmgãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:"
        echo "Path: $DMG_PATH"
        echo "Name: $DMG_NAME"
        echo "Size: $DMG_SIZE"
        
    - name: æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ã®ç¢ºèª
      if: success() && github.ref_name == 'main' && github.event_name == 'push'
      id: check-release
      run: |
        # æ—¢å­˜ã®ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        RELEASE_TAG="${{ steps.version.outputs.release_tag }}"
        
        # GitHub APIã‚’ä½¿ç”¨ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã®å­˜åœ¨ã‚’ç¢ºèª
        RELEASE_EXISTS=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          "https://api.github.com/repos/${{ github.repository }}/releases/tags/$RELEASE_TAG" \
          | jq -r '.tag_name // empty')
        
        if [ -n "$RELEASE_EXISTS" ]; then
          echo "release_exists=true" >> $GITHUB_OUTPUT
          echo "æ—¢å­˜ã®ãƒªãƒªãƒ¼ã‚¹ $RELEASE_TAG ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"
        else
          echo "release_exists=false" >> $GITHUB_OUTPUT
          echo "æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ $RELEASE_TAG ã‚’ä½œæˆã—ã¾ã™"
        fi
        
    - name: ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      id: generate-release-notes
      run: |
        # å‰å›ã®ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’å–å¾—
        PREVIOUS_TAG=$(git describe --tags --abbrev=0 HEAD^ 2>/dev/null || echo "")
        
        # ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®ãƒ™ãƒ¼ã‚¹éƒ¨åˆ†ã‚’ä½œæˆ
        RELEASE_NOTES="## ğŸ‰ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹: ${{ steps.version.outputs.release_tag }}

        ### ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        - **MacOS**: ${{ steps.dmg-path.outputs.dmg_name }} (${{ steps.dmg-path.outputs.dmg_size }})

        ### ğŸ“‹ ãƒ“ãƒ«ãƒ‰æƒ…å ±
        - **ã‚³ãƒŸãƒƒãƒˆ**: ${{ github.sha }}
        - **ãƒ“ãƒ«ãƒ‰æ—¥æ™‚**: $(date -Iseconds)
        - **ãƒ“ãƒ«ãƒ‰è€…**: ${{ github.actor }}"
        
        # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰å¤‰æ›´å±¥æ­´ã‚’ç”Ÿæˆ
        if [ -n "$PREVIOUS_TAG" ]; then
          echo "å‰å›ã®ãƒªãƒªãƒ¼ã‚¹: $PREVIOUS_TAG"
          
          # å‰å›ã®ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ä»Šå›ã¾ã§ã®ã‚³ãƒŸãƒƒãƒˆã‚’å–å¾—
          COMMITS=$(git log --pretty=format:"- %s (%an)" ${PREVIOUS_TAG}..HEAD --no-merges)
          
          if [ -n "$COMMITS" ]; then
            RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ“ å¤‰æ›´å±¥æ­´
        $COMMITS"
          fi
          
          # æ©Ÿèƒ½è¿½åŠ ã€ãƒã‚°ä¿®æ­£ã€ãã®ä»–ã«åˆ†é¡
          FEATURES=$(git log --pretty=format:"- %s" ${PREVIOUS_TAG}..HEAD --no-merges --grep="feat\|feature\|add\|æ–°æ©Ÿèƒ½\|è¿½åŠ " --grep="^feat" --grep="^add")
          FIXES=$(git log --pretty=format:"- %s" ${PREVIOUS_TAG}..HEAD --no-merges --grep="fix\|bug\|ä¿®æ­£\|ãƒã‚°" --grep="^fix")
          OTHERS=$(git log --pretty=format:"- %s" ${PREVIOUS_TAG}..HEAD --no-merges --invert-grep --grep="feat\|feature\|add\|æ–°æ©Ÿèƒ½\|è¿½åŠ \|fix\|bug\|ä¿®æ­£\|ãƒã‚°")
          
          if [ -n "$FEATURES" ]; then
            RELEASE_NOTES="$RELEASE_NOTES

        ### âœ¨ æ–°æ©Ÿèƒ½ãƒ»æ”¹å–„
        $FEATURES"
          fi
          
          if [ -n "$FIXES" ]; then
            RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ› ãƒã‚°ä¿®æ­£
        $FIXES"
          fi
          
          if [ -n "$OTHERS" ]; then
            RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ”§ ãã®ä»–ã®å¤‰æ›´
        $OTHERS"
          fi
        else
          echo "åˆå›ãƒªãƒªãƒ¼ã‚¹ã§ã™"
          RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ“ å¤‰æ›´å±¥æ­´
        - åˆå›ãƒªãƒªãƒ¼ã‚¹"
        fi
        
        # çµ±è¨ˆæƒ…å ±ã‚’è¿½åŠ 
        if [ -n "$PREVIOUS_TAG" ]; then
          COMMIT_COUNT=$(git rev-list --count ${PREVIOUS_TAG}..HEAD)
          FILES_CHANGED=$(git diff --name-only ${PREVIOUS_TAG}..HEAD | wc -l)
          
          RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ“Š çµ±è¨ˆæƒ…å ±
        - ã‚³ãƒŸãƒƒãƒˆæ•°: $COMMIT_COUNT
        - å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°: $FILES_CHANGED"
        fi
        
        # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¨æ³¨æ„äº‹é …ã‚’è¿½åŠ 
        RELEASE_NOTES="$RELEASE_NOTES

        ### ğŸ”§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
        1. ä¸Šè¨˜ã®dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        2. dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¦ãƒ³ãƒˆ
        3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Applicationsãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

        ### âš ï¸ æ³¨æ„äº‹é …
        - åˆå›èµ·å‹•æ™‚ã«macOSã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
        - ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‹ã‚‰è¨±å¯ã—ã¦ãã ã•ã„
        - é–‹ç™ºç’°å¢ƒã¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã¯ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¾ã™

        ### ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯
        - [ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](${{ github.server_url }}/${{ github.repository }})
        - [å•é¡Œå ±å‘Š](${{ github.server_url }}/${{ github.repository }}/issues)
        - [ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³](${{ github.server_url }}/${{ github.repository }}/discussions)

        ---

        ã“ã®ãƒªãƒªãƒ¼ã‚¹ã¯è‡ªå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚  
        ç”Ÿæˆæ—¥æ™‚: $(date -Iseconds)"
        
        # ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        echo "$RELEASE_NOTES" > release-notes.md
        
        # GitHub Outputã«è¨­å®šï¼ˆæ”¹è¡Œã‚’é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
        echo "release_notes<<EOF" >> $GITHUB_OUTPUT
        echo "$RELEASE_NOTES" >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
        
        echo "ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ"
        
    - name: GitHubãƒªãƒªãƒ¼ã‚¹ã®ä½œæˆ
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      id: create-release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ steps.version.outputs.release_tag }}
        release_name: ${{ steps.version.outputs.release_name }}
        body: ${{ steps.generate-release-notes.outputs.release_notes }}
        draft: false
        prerelease: false
        
    - name: dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒªãƒ¼ã‚¹ã‚¢ã‚»ãƒƒãƒˆæ·»ä»˜
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create-release.outputs.upload_url }}
        asset_path: ${{ steps.dmg-path.outputs.dmg_path }}
        asset_name: ${{ steps.dmg-path.outputs.dmg_name }}
        asset_content_type: application/x-apple-diskimage
        
    - name: æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ã¸ã®ã‚¢ã‚»ãƒƒãƒˆæ›´æ–°
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'true'
      run: |
        echo "::warning::æ—¢å­˜ã®ãƒªãƒªãƒ¼ã‚¹ ${{ steps.version.outputs.release_tag }} ãŒå­˜åœ¨ã—ã¾ã™"
        echo "::notice::æ–°ã—ã„ãƒ“ãƒ«ãƒ‰ã¯æˆæœç‰©ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã—ãŸ: macos-dmg-${{ github.sha }}"
        echo "æ‰‹å‹•ã§ãƒªãƒªãƒ¼ã‚¹ã‚’æ›´æ–°ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„:"
        echo "ãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.dmg-path.outputs.dmg_path }}"
        echo "ã‚µã‚¤ã‚º: ${{ steps.dmg-path.outputs.dmg_size }}"
        
    - name: ãƒªãƒªãƒ¼ã‚¹ä½œæˆæˆåŠŸé€šçŸ¥
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      run: |
        echo "::notice title=ãƒªãƒªãƒ¼ã‚¹ä½œæˆæˆåŠŸ::GitHubãƒªãƒªãƒ¼ã‚¹ ${{ steps.version.outputs.release_tag }} ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ"
        echo "::notice::ãƒªãƒªãƒ¼ã‚¹å: ${{ steps.version.outputs.release_name }}"
        echo "::notice::dmgãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.dmg-path.outputs.dmg_name }}"
        echo "::notice::ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${{ steps.dmg-path.outputs.dmg_size }}"
        echo "::notice::ãƒªãƒªãƒ¼ã‚¹URL: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }}"
        
    - name: ãƒ“ãƒ«ãƒ‰æˆåŠŸé€šçŸ¥
      if: success()
      run: |
        echo "::notice title=ãƒ“ãƒ«ãƒ‰æˆåŠŸ::MacOSãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"
        echo "::notice::æˆæœç‰©: macos-dmg-${{ github.sha }}"
        echo "::notice::ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}"
        echo "::notice::ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}"
        echo "ãƒ“ãƒ«ãƒ‰å®Œäº†: $(date)"
        echo "æˆæœç‰©ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ"
        
        # mainãƒ–ãƒ©ãƒ³ãƒã®å ´åˆã¯ãƒªãƒªãƒ¼ã‚¹æƒ…å ±ã‚‚è¡¨ç¤º
        if [ "${{ github.ref_name }}" = "main" ] && [ "${{ github.event_name }}" = "push" ]; then
          if [ "${{ steps.check-release.outputs.release_exists }}" = "false" ]; then
            echo "::notice::GitHubãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã—ãŸ: ${{ steps.version.outputs.release_tag }}"
          else
            echo "::notice::æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€æˆæœç‰©ã®ã¿ä¿å­˜ã•ã‚Œã¾ã—ãŸ"
          fi
        fi
        
    # é«˜åº¦ãªé€šçŸ¥æ©Ÿèƒ½
    - name: GitHub Issuesé€šçŸ¥ã®ä½œæˆï¼ˆãƒªãƒªãƒ¼ã‚¹æˆåŠŸæ™‚ï¼‰
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          // ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥ç”¨ã®Issueã‚’ä½œæˆ
          const issueTitle = `ğŸ‰ ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥: ${{ steps.version.outputs.release_tag }}`;
          const issueBody = `
          ## ğŸ“¦ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸ
          
          **ãƒªãƒªãƒ¼ã‚¹æƒ…å ±:**
          - **ãƒªãƒªãƒ¼ã‚¹å**: ${{ steps.version.outputs.release_name }}
          - **ã‚¿ã‚°**: ${{ steps.version.outputs.release_tag }}
          - **dmgãƒ•ã‚¡ã‚¤ãƒ«**: ${{ steps.dmg-path.outputs.dmg_name }}
          - **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: ${{ steps.dmg-path.outputs.dmg_size }}
          
          **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯:**
          [${{ steps.version.outputs.release_tag }}ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }})
          
          **ãƒ“ãƒ«ãƒ‰è©³ç´°:**
          - **ã‚³ãƒŸãƒƒãƒˆ**: ${{ github.sha }}
          - **ãƒ–ãƒ©ãƒ³ãƒ**: ${{ github.ref_name }}
          - **å®Ÿè¡Œè€…**: ${{ github.actor }}
          - **å®Ÿè¡Œæ™‚åˆ»**: ${new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [${{ github.run_id }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          
          **æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
          - [ ] ãƒªãƒªãƒ¼ã‚¹ã®å‹•ä½œç¢ºèª
          - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å‘ŠçŸ¥
          - [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
          
          ---
          
          ã“ã®Issueã¯è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚ç¢ºèªå¾Œã«ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ãã ã•ã„ã€‚
          `;
          
          try {
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: issueTitle,
              body: issueBody,
              labels: ['release', 'notification', 'automated']
            });
            
            console.log(`ãƒªãƒªãƒ¼ã‚¹é€šçŸ¥Issueä½œæˆå®Œäº†: #${issue.data.number}`);
            
            // é–¢ä¿‚è€…ã«ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
            const maintainers = process.env.MAINTAINERS || '';
            if (maintainers) {
              const mentionComment = `é–¢ä¿‚è€…ã®çš†æ§˜ã¸é€šçŸ¥: ${maintainers}\n\næ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã”ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.data.number,
                body: mentionComment
              });
            }
            
          } catch (error) {
            console.error('Issueä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            core.setFailed(`Issueä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
          }
      continue-on-error: true
      env:
        MAINTAINERS: ${{ vars.MAINTAINERS || '' }}
        
    - name: GitHub Discussioné€šçŸ¥ã®ä½œæˆï¼ˆãƒªãƒªãƒ¼ã‚¹æˆåŠŸæ™‚ï¼‰
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          // ãƒªãƒªãƒ¼ã‚¹å‘ŠçŸ¥ç”¨ã®Discussionã‚’ä½œæˆ
          const discussionTitle = `ğŸ“¢ ${{ steps.version.outputs.release_tag }} ãƒªãƒªãƒ¼ã‚¹ã®ãŠçŸ¥ã‚‰ã›`;
          const discussionBody = `
          ## ğŸ‰ æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸï¼
          
          **${{ steps.version.outputs.release_name }}** ãŒæ­£å¼ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚
          
          ### ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          
          **MacOSç”¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³:**
          [${{ steps.dmg-path.outputs.dmg_name }}ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }})
          
          **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:** ${{ steps.dmg-path.outputs.dmg_size }}
          
          ### ğŸ”§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
          
          1. ä¸Šè¨˜ã®dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          2. dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¦ãƒ³ãƒˆ
          3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Applicationsãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
          4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
          
          ### âš ï¸ æ³¨æ„äº‹é …
          
          - åˆå›èµ·å‹•æ™‚ã«macOSã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
          - ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‹ã‚‰è¨±å¯ã—ã¦ãã ã•ã„
          - é–‹ç™ºç’°å¢ƒã¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã¯ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¾ã™
          
          ### ğŸ› å•é¡Œå ±å‘Š
          
          ä½•ã‹å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€[Issues](${{ github.server_url }}/${{ github.repository }}/issues)ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
          
          ### ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
          
          ã“ã®ãƒªãƒªãƒ¼ã‚¹ã«ã¤ã„ã¦ã®ã”æ„è¦‹ãƒ»ã”æ„Ÿæƒ³ã‚’ãŠèã‹ã›ãã ã•ã„ï¼
          
          ---
          
          ãƒªãƒªãƒ¼ã‚¹æ—¥æ™‚: ${new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}  
          ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}
          `;
          
          try {
            // GraphQL APIã‚’ä½¿ç”¨ã—ã¦Discussionã‚’ä½œæˆ
            const query = \`
              mutation CreateDiscussion($repositoryId: ID!, $categoryId: ID!, $title: String!, $body: String!) {
                createDiscussion(input: {
                  repositoryId: $repositoryId,
                  categoryId: $categoryId,
                  title: $title,
                  body: $body
                }) {
                  discussion {
                    id
                    number
                    url
                  }
                }
              }
            \`;
            
            // ãƒªãƒã‚¸ãƒˆãƒªIDã‚’å–å¾—
            const repoQuery = \`
              query GetRepository($owner: String!, $name: String!) {
                repository(owner: $owner, name: $name) {
                  id
                  discussionCategories(first: 10) {
                    nodes {
                      id
                      name
                    }
                  }
                }
              }
            \`;
            
            const repoData = await github.graphql(repoQuery, {
              owner: context.repo.owner,
              name: context.repo.repo
            });
            
            // "Announcements"ã‚«ãƒ†ã‚´ãƒªã‚’æ¢ã™ï¼ˆãªã‘ã‚Œã°æœ€åˆã®ã‚«ãƒ†ã‚´ãƒªã‚’ä½¿ç”¨ï¼‰
            const categories = repoData.repository.discussionCategories.nodes;
            const announcementCategory = categories.find(cat => 
              cat.name.toLowerCase().includes('announcement') || 
              cat.name.toLowerCase().includes('ãŠçŸ¥ã‚‰ã›') ||
              cat.name.toLowerCase().includes('release')
            ) || categories[0];
            
            if (!announcementCategory) {
              console.log('Discussionã‚«ãƒ†ã‚´ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚Discussionã®ä½œæˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚');
              return;
            }
            
            const discussionData = await github.graphql(query, {
              repositoryId: repoData.repository.id,
              categoryId: announcementCategory.id,
              title: discussionTitle,
              body: discussionBody
            });
            
            console.log(\`ãƒªãƒªãƒ¼ã‚¹å‘ŠçŸ¥Discussionä½œæˆå®Œäº†: #\${discussionData.createDiscussion.discussion.number}\`);
            console.log(\`URL: \${discussionData.createDiscussion.discussion.url}\`);
            
          } catch (error) {
            console.error('Discussionä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            // DiscussionãŒç„¡åŠ¹ãªå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ï¼‰
            console.log('Discussionã®ä½œæˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
          }
      continue-on-error: true
      
    - name: Slacké€šçŸ¥ã®é€ä¿¡
      if: always() && (success() || failure())
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#ci-cd'
        text: |
          MacOSãƒ“ãƒ«ãƒ‰ ${{ job.status == 'success' && 'æˆåŠŸ' || 'å¤±æ•—' }}
          ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}
          ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}
          å®Ÿè¡Œè€…: ${{ github.actor }}
          ${{ job.status == 'success' && 'æˆæœç‰©ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™' || 'ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„' }}
          ${{ job.status == 'success' && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false' && format('ğŸ‰ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã—ãŸ: {0}', steps.version.outputs.release_tag) || '' }}
        webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
      continue-on-error: true  # é€šçŸ¥å¤±æ•—ã§ã‚‚ãƒ“ãƒ«ãƒ‰ã¯æˆåŠŸæ‰±ã„
      
    - name: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®é€ä¿¡ï¼ˆå¤±æ•—æ™‚ï¼‰
      if: failure() && github.ref_name == 'main'
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: '[ç·Šæ€¥] MacOSãƒ“ãƒ«ãƒ‰å¤±æ•— - ${{ github.repository }}'
        to: ${{ secrets.NOTIFICATION_EMAIL }}
        from: 'GitHub Actions <noreply@github.com>'
        body: |
          MacOSãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
          
          ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.repository }}
          ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}
          ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}
          å®Ÿè¡Œè€…: ${{ github.actor }}
          å®Ÿè¡Œæ™‚åˆ»: ${{ github.event.head_commit.timestamp }}
          
          è©³ç´°ãƒ­ã‚°: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          
          è‡³æ€¥ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
      continue-on-error: true
      
    - name: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®é€ä¿¡ï¼ˆãƒªãƒªãƒ¼ã‚¹æˆåŠŸæ™‚ï¼‰
      if: success() && github.ref_name == 'main' && github.event_name == 'push' && steps.check-release.outputs.release_exists == 'false'
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: 'ğŸ‰ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ä½œæˆå®Œäº† - ${{ steps.version.outputs.release_tag }}'
        to: ${{ secrets.NOTIFICATION_EMAIL }}
        from: 'GitHub Actions <noreply@github.com>'
        body: |
          æ–°ã—ã„MacOSãƒªãƒªãƒ¼ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚
          
          ğŸ“¦ ãƒªãƒªãƒ¼ã‚¹æƒ…å ±:
          - ãƒªãƒªãƒ¼ã‚¹å: ${{ steps.version.outputs.release_name }}
          - ã‚¿ã‚°: ${{ steps.version.outputs.release_tag }}
          - dmgãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.dmg-path.outputs.dmg_name }}
          - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${{ steps.dmg-path.outputs.dmg_size }}
          
          ğŸ”— ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
          ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }}
          
          ğŸ“‹ ãƒ“ãƒ«ãƒ‰æƒ…å ±:
          - ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.repository }}
          - ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}
          - ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}
          - å®Ÿè¡Œè€…: ${{ github.actor }}
          - å®Ÿè¡Œæ™‚åˆ»: ${{ github.event.head_commit.timestamp }}
          
          ãƒªãƒªãƒ¼ã‚¹ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚
      continue-on-error: true
      
    # é€šçŸ¥çµ±åˆã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
    - name: é€šçŸ¥çŠ¶æ³ã®ç¢ºèªã¨çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ
      if: always() && github.ref_name == 'main' && github.event_name == 'push'
      run: |
        echo "=== é€šçŸ¥æ©Ÿèƒ½å®Ÿè¡Œçµæœãƒ¬ãƒãƒ¼ãƒˆ ==="
        echo "å®Ÿè¡Œæ—¥æ™‚: $(date -Iseconds)"
        echo "ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.repository }}"
        echo "ã‚³ãƒŸãƒƒãƒˆ: ${{ github.sha }}"
        echo "ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}"
        echo "å®Ÿè¡Œè€…: ${{ github.actor }}"
        echo ""
        
        # ãƒ“ãƒ«ãƒ‰çµæœã®ç¢ºèª
        if [ "${{ job.status }}" = "success" ]; then
          echo "âœ… ãƒ“ãƒ«ãƒ‰çŠ¶æ³: æˆåŠŸ"
          
          # ãƒªãƒªãƒ¼ã‚¹ä½œæˆçŠ¶æ³ã®ç¢ºèª
          if [ "${{ steps.check-release.outputs.release_exists }}" = "false" ]; then
            echo "âœ… ãƒªãƒªãƒ¼ã‚¹ä½œæˆ: æˆåŠŸ"
            echo "   - ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°: ${{ steps.version.outputs.release_tag }}"
            echo "   - ãƒªãƒªãƒ¼ã‚¹å: ${{ steps.version.outputs.release_name }}"
            echo "   - dmgãƒ•ã‚¡ã‚¤ãƒ«: ${{ steps.dmg-path.outputs.dmg_name }}"
            echo "   - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${{ steps.dmg-path.outputs.dmg_size }}"
            echo "   - ãƒªãƒªãƒ¼ã‚¹URL: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }}"
            
            # é€šçŸ¥æ©Ÿèƒ½ã®å®Ÿè¡ŒçŠ¶æ³ã‚’è¨˜éŒ²
            echo ""
            echo "ğŸ“¢ å®Ÿè¡Œã•ã‚ŒãŸé€šçŸ¥æ©Ÿèƒ½:"
            echo "   - GitHub Issuesé€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿"
            echo "   - GitHub Discussioné€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿"
            echo "   - Slacké€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰"
            echo "   - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰"
            echo "   - GitHub Actionsé€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿"
            
            # é–¢ä¿‚è€…ã¸ã®é€šçŸ¥ç¢ºèª
            echo ""
            echo "ğŸ‘¥ é–¢ä¿‚è€…é€šçŸ¥çŠ¶æ³:"
            if [ -n "${{ vars.MAINTAINERS }}" ]; then
              echo "   - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼: ${{ vars.MAINTAINERS }}"
              echo "   - é€šçŸ¥æ–¹æ³•: GitHub Issues, Discussion"
            else
              echo "   - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼: æœªè¨­å®šï¼ˆMAINTAINERSå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼‰"
            fi
            
            if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
              echo "   - Slacké€šçŸ¥: è¨­å®šæ¸ˆã¿"
            else
              echo "   - Slacké€šçŸ¥: æœªè¨­å®šï¼ˆSLACK_WEBHOOK_URLç§˜å¯†ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼‰"
            fi
            
            if [ -n "${{ secrets.NOTIFICATION_EMAIL }}" ]; then
              echo "   - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥: è¨­å®šæ¸ˆã¿"
            else
              echo "   - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥: æœªè¨­å®šï¼ˆNOTIFICATION_EMAILç§˜å¯†ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼‰"
            fi
            
          else
            echo "â„¹ï¸  ãƒªãƒªãƒ¼ã‚¹ä½œæˆ: æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹å­˜åœ¨ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—"
            echo "   - æ—¢å­˜ã‚¿ã‚°: ${{ steps.version.outputs.release_tag }}"
            echo "   - æˆæœç‰©: macos-dmg-${{ github.sha }} ã¨ã—ã¦ä¿å­˜æ¸ˆã¿"
          fi
          
        else
          echo "âŒ ãƒ“ãƒ«ãƒ‰çŠ¶æ³: å¤±æ•—"
          echo "   - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°: build-logs-${{ github.sha }} ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
          echo "   - å®Ÿè¡Œãƒ­ã‚°: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          
          # å¤±æ•—æ™‚ã®é€šçŸ¥çŠ¶æ³
          echo ""
          echo "ğŸ“¢ å¤±æ•—é€šçŸ¥æ©Ÿèƒ½:"
          echo "   - GitHub Actionsé€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿"
          echo "   - Slacké€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰"
          echo "   - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥: å®Ÿè¡Œæ¸ˆã¿ï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰"
        fi
        
        echo ""
        echo "=== é€šçŸ¥è¨­å®šã®æ¨å¥¨äº‹é … ==="
        echo "ã‚ˆã‚ŠåŠ¹æœçš„ãªé€šçŸ¥ã®ãŸã‚ã«ã€ä»¥ä¸‹ã®è¨­å®šã‚’æ¤œè¨ã—ã¦ãã ã•ã„:"
        echo ""
        echo "1. ãƒªãƒã‚¸ãƒˆãƒªå¤‰æ•°ã®è¨­å®š:"
        echo "   - MAINTAINERS: é–¢ä¿‚è€…ã®GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆä¾‹: @user1 @user2ï¼‰"
        echo ""
        echo "2. ãƒªãƒã‚¸ãƒˆãƒªç§˜å¯†ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:"
        echo "   - SLACK_WEBHOOK_URL: Slack Incoming Webhook URL"
        echo "   - NOTIFICATION_EMAIL: é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
        echo "   - MAIL_USERNAME: SMTPèªè¨¼ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
        echo "   - MAIL_PASSWORD: SMTPèªè¨¼ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
        echo ""
        echo "3. GitHubæ©Ÿèƒ½ã®æ´»ç”¨:"
        echo "   - Issues: è‡ªå‹•ä½œæˆã•ã‚Œã‚‹é€šçŸ¥Issueã‚’ç¢ºèª"
        echo "   - Discussions: ãƒªãƒªãƒ¼ã‚¹å‘ŠçŸ¥ã®ç¢ºèª"
        echo "   - Releases: è‡ªå‹•ä½œæˆã•ã‚Œã‚‹ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã®ç¢ºèª"
        echo ""
        echo "=== ãƒ¬ãƒãƒ¼ãƒˆçµ‚äº† ==="
        
    # æœ€çµ‚çš„ãªé€šçŸ¥ç¢ºèªã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    - name: æœ€çµ‚é€šçŸ¥ç¢ºèªã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      if: always()
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          // æœ€çµ‚çš„ãªé€šçŸ¥çŠ¶æ³ã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥ã‚’å®Ÿè¡Œ
          const jobStatus = '${{ job.status }}';
          const isMainBranch = '${{ github.ref_name }}' === 'main';
          const isPush = '${{ github.event_name }}' === 'push';
          const releaseCreated = '${{ steps.check-release.outputs.release_exists }}' === 'false';
          
          console.log('=== æœ€çµ‚é€šçŸ¥ç¢ºèª ===');
          console.log(`ã‚¸ãƒ§ãƒ–çŠ¶æ³: ${jobStatus}`);
          console.log(`mainãƒ–ãƒ©ãƒ³ãƒ: ${isMainBranch}`);
          console.log(`ãƒ—ãƒƒã‚·ãƒ¥ã‚¤ãƒ™ãƒ³ãƒˆ: ${isPush}`);
          console.log(`ãƒªãƒªãƒ¼ã‚¹ä½œæˆ: ${releaseCreated}`);
          
          // æˆåŠŸæ™‚ã®æœ€çµ‚ç¢ºèª
          if (jobStatus === 'success') {
            console.log('âœ… ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ');
            
            if (isMainBranch && isPush) {
              if (releaseCreated) {
                console.log('ğŸ‰ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã€ã™ã¹ã¦ã®é€šçŸ¥ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸ');
                
                // æˆåŠŸã®æœ€çµ‚é€šçŸ¥ã‚’GitHub Actionsãƒ­ã‚°ã«è¨˜éŒ²
                core.notice('ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥', {
                  title: 'ãƒªãƒªãƒ¼ã‚¹ä½œæˆæˆåŠŸ',
                  file: '.github/workflows/release.yml'
                });
                
                core.notice(`æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ ${{ steps.version.outputs.release_tag }} ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ`, {
                  title: 'ãƒªãƒªãƒ¼ã‚¹æƒ…å ±'
                });
                
                core.notice(`ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.version.outputs.release_tag }}`, {
                  title: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯'
                });
                
              } else {
                console.log('â„¹ï¸ æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€æˆæœç‰©ã®ã¿ä¿å­˜ã•ã‚Œã¾ã—ãŸ');
                
                core.notice('æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹æ¤œå‡º', {
                  title: 'ãƒªãƒªãƒ¼ã‚¹çŠ¶æ³',
                  file: '.github/workflows/release.yml'
                });
              }
            } else {
              console.log('â„¹ï¸ é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒã§ã®ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ');
            }
            
          } else {
            console.log('âŒ ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ');
            
            // å¤±æ•—æ™‚ã®ç·Šæ€¥é€šçŸ¥
            core.error('ãƒ“ãƒ«ãƒ‰å¤±æ•—', {
              title: 'CI/CDã‚¨ãƒ©ãƒ¼',
              file: '.github/workflows/release.yml'
            });
            
            if (isMainBranch) {
              core.error('mainãƒ–ãƒ©ãƒ³ãƒã§ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è‡³æ€¥ç¢ºèªãŒå¿…è¦ã§ã™ã€‚', {
                title: 'ç·Šæ€¥: mainãƒ–ãƒ©ãƒ³ãƒãƒ“ãƒ«ãƒ‰å¤±æ•—'
              });
            }
          }
          
          // é€šçŸ¥æ©Ÿèƒ½ã®è¦ä»¶å……è¶³ç¢ºèª
          console.log('');
          console.log('=== è¦ä»¶5.4ã®å……è¶³ç¢ºèª ===');
          console.log('è¦ä»¶: ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œäº†ã™ã‚‹ THEN ã‚·ã‚¹ãƒ†ãƒ ã¯é–¢ä¿‚è€…ã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹');
          console.log('');
          
          if (jobStatus === 'success' && isMainBranch && isPush && releaseCreated) {
            console.log('âœ… å®Ÿè£…ã•ã‚ŒãŸé€šçŸ¥æ©Ÿèƒ½:');
            console.log('   1. GitHub Issuesé€šçŸ¥ - ãƒªãƒªãƒ¼ã‚¹å®Œäº†Issueè‡ªå‹•ä½œæˆ');
            console.log('   2. GitHub Discussioné€šçŸ¥ - ãƒªãƒªãƒ¼ã‚¹å‘ŠçŸ¥Discussionä½œæˆ');
            console.log('   3. GitHub Actionsé€šçŸ¥ - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã§ã®é€šçŸ¥');
            console.log('   4. Slacké€šçŸ¥ - è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«é€ä¿¡');
            console.log('   5. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ - è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«é€ä¿¡');
            console.log('   6. é–¢ä¿‚è€…ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ - MAINTAINERSå¤‰æ•°è¨­å®šæ™‚');
            console.log('');
            console.log('âœ… è¦ä»¶5.4ã¯æ­£å¸¸ã«æº€ãŸã•ã‚Œã¦ã„ã¾ã™');
          } else {
            console.log('â„¹ï¸ ãƒªãƒªãƒ¼ã‚¹ä½œæˆæ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„ãŸã‚ã€é€šçŸ¥ã¯é™å®šçš„ã§ã™');
          }
          
          console.log('=== æœ€çµ‚ç¢ºèªå®Œäº† ===');