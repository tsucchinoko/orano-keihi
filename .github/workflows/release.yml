name: ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: pnpmã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: pnpm/action-setup@v4
      with:
        version: latest
        
    - name: ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å¾©å…ƒ
      uses: actions/cache@v4
      with:
        path: |
          ~/.pnpm-store
          ~/.cargo/registry
          ~/.cargo/git
          src-tauri/target
        key: ${{ runner.os }}-deps-${{ hashFiles('**/pnpm-lock.yaml', '**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-deps-
        
    - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        echo "ğŸ“¦ MacOSç”¨ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
        if ! pnpm install --frozen-lockfile; then
          echo "âŒ MacOSä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ"
          echo "::error title=MacOSä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼::pnpmã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "--- pnpmç’°å¢ƒæƒ…å ± ---"
          pnpm --version || echo "pnpmãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—"
          node --version || echo "Nodeãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—"
          echo "--- package.jsonã®ç¢ºèª ---"
          cat package.json | head -20 || echo "package.jsonèª­ã¿å–ã‚Šå¤±æ•—"
          echo "--- pnpm-lock.yamlã®ç¢ºèª ---"
          ls -la pnpm-lock.yaml || echo "pnpm-lock.yamlç¢ºèªå¤±æ•—"
          exit 1
        fi
        echo "âœ… MacOSä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ"
        
    - name: Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      run: |
        echo "ğŸ¦€ MacOSç”¨Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
        if ! rustup show; then
          echo "âŒ Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ"
          echo "::error title=MacOS Rustã‚¨ãƒ©ãƒ¼::Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "--- Rustç’°å¢ƒæƒ…å ± ---"
          rustup --version || echo "rustupãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—"
          rustc --version || echo "rustcãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—"
          cargo --version || echo "cargoãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—"
          exit 1
        fi
        echo "âœ… MacOS Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ"
        
    - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
      run: |
        echo "ğŸ—ï¸ MacOSç”¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
        if ! pnpm build; then
          echo "âŒ MacOSãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "::error title=MacOSãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼::SvelteKitãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "--- ãƒ“ãƒ«ãƒ‰ç’°å¢ƒæƒ…å ± ---"
          echo "Node.js: $(node --version)"
          echo "pnpm: $(pnpm --version)"
          echo "--- package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª ---"
          cat package.json | grep -A 10 '"scripts"' || echo "ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèªå¤±æ•—"
          echo "--- ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---"
          ls -la . || echo "ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—"
          echo "--- viteè¨­å®šç¢ºèª ---"
          cat vite.config.js || echo "viteè¨­å®šç¢ºèªå¤±æ•—"
          exit 1
        fi
        echo "âœ… MacOSãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"
        echo "--- ãƒ“ãƒ«ãƒ‰æˆæœç‰©ç¢ºèª ---"
        ls -la build/ || echo "ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—"
        
    - name: Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
      run: |
        echo "ğŸš€ MacOSç”¨Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
        export TAURI_ENV=production
        echo "ç’°å¢ƒå¤‰æ•°è¨­å®š: TAURI_ENV=$TAURI_ENV"
        
        # ãƒ“ãƒ«ãƒ‰å‰ã®ç’°å¢ƒç¢ºèª
        echo "--- ãƒ“ãƒ«ãƒ‰å‰ç’°å¢ƒç¢ºèª ---"
        echo "Rust: $(rustc --version)"
        echo "Cargo: $(cargo --version)"
        echo "Tauri CLI: $(pnpm tauri --version || echo 'Tauri CLIç¢ºèªå¤±æ•—')"
        
        # Tauriãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œ
        if ! pnpm tauri build --bundles dmg --verbose 2>&1 | tee /tmp/tauri-build.log; then
          echo "âŒ MacOS Tauriãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          echo "::error title=MacOS Tauriãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼::Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          
          echo "--- è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚° ---"
          cat /tmp/tauri-build.log | tail -50 || echo "ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šå¤±æ•—"
          
          echo "--- Tauriè¨­å®šç¢ºèª ---"
          cat src-tauri/tauri.conf.json | head -30 || echo "Tauriè¨­å®šç¢ºèªå¤±æ•—"
          
          echo "--- Cargo.tomlç¢ºèª ---"
          cat src-tauri/Cargo.toml || echo "Cargo.tomlç¢ºèªå¤±æ•—"
          
          echo "--- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---"
          ls -la src-tauri/target/ || echo "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—"
          
          echo "--- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± ---"
          uname -a || echo "ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—å¤±æ•—"
          xcode-select --version || echo "Xcodeæƒ…å ±å–å¾—å¤±æ•—"
          
          exit 1
        fi
        echo "âœ… MacOS Tauriãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"
        
    - name: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ç¢ºèª
      run: |
        echo "ğŸ“‹ MacOSãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ç¢ºèªä¸­..."
        
        # ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
        if [ ! -d "src-tauri/target/release/bundle" ]; then
          echo "âŒ ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"
          echo "::error title=MacOSæˆæœç‰©ã‚¨ãƒ©ãƒ¼::ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          echo "--- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€  ---"
          find src-tauri/target -type d -name "*bundle*" || echo "ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¤œç´¢å¤±æ•—"
          ls -la src-tauri/target/release/ || echo "ãƒªãƒªãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—"
          exit 1
        fi
        
        # dmgãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢
        DMG_FILES=$(find src-tauri/target/release/bundle -name "*.dmg" -type f)
        if [ -z "$DMG_FILES" ]; then
          echo "âŒ dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          echo "::error title=MacOS dmgã‚¨ãƒ©ãƒ¼::ç”Ÿæˆã•ã‚ŒãŸdmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          echo "--- ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹ ---"
          find src-tauri/target/release/bundle -type f || echo "ãƒãƒ³ãƒ‰ãƒ«å†…å®¹ç¢ºèªå¤±æ•—"
          echo "--- dmgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---"
          ls -la src-tauri/target/release/bundle/dmg/ || echo "dmgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—"
          exit 1
        fi
        
        echo "âœ… è¦‹ã¤ã‹ã£ãŸdmgãƒ•ã‚¡ã‚¤ãƒ«:"
        for dmg in $DMG_FILES; do
          echo "  - $dmg ($(du -h "$dmg" | cut -f1))"
        done

        
    - name: dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: macos-dmg-${{ github.sha }}
        path: src-tauri/target/release/bundle/dmg/*.dmg
        if-no-files-found: error
        retention-days: 30
        
    - name: MacOSãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã®é€šçŸ¥
      if: failure()
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          
          // ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®è©³ç´°æƒ…å ±ã‚’åé›†
          const failureInfo = {
            platform: 'MacOS',
            commit: context.sha,
            actor: context.actor,
            runId: context.runId,
            timestamp: new Date().toISOString(),
            branch: context.ref_name || 'unknown'
          };
          
          // Issueä½œæˆã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã§ã‚¨ãƒ©ãƒ¼å ±å‘Š
          const issueTitle = `ğŸš¨ MacOSãƒ“ãƒ«ãƒ‰å¤±æ•— - ${failureInfo.commit.substring(0, 7)}`;
          const issueBody = `## MacOSãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼å ±å‘Š
          
          **ğŸ“‹ ãƒ“ãƒ«ãƒ‰æƒ…å ±**
          - **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ${failureInfo.platform}
          - **ã‚³ãƒŸãƒƒãƒˆ**: ${failureInfo.commit}
          - **ãƒ–ãƒ©ãƒ³ãƒ**: ${failureInfo.branch}
          - **å®Ÿè¡Œè€…**: ${failureInfo.actor}
          - **å¤±æ•—æ™‚åˆ»**: ${failureInfo.timestamp}
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [#${failureInfo.runId}](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${failureInfo.runId})
          
          **ğŸ” ç¢ºèªäº‹é …**
          - [ ] ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼
          - [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] Tauriãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] dmgãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼
          - [ ] ç’°å¢ƒè¨­å®šã‚¨ãƒ©ãƒ¼
          
          **ğŸ“ å¯¾å¿œæ–¹æ³•**
          1. ä¸Šè¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒªãƒ³ã‚¯ã‹ã‚‰è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª
          2. ã‚¨ãƒ©ãƒ¼ã®åŸå› ã‚’ç‰¹å®š
          3. å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯è¨­å®šã‚’ä¿®æ­£
          4. ä¿®æ­£å¾Œã«å†åº¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
          
          **âš ï¸ æ³¨æ„**: ã“ã®Issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚è§£æ±ºå¾Œã¯ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ãã ã•ã„ã€‚`;
          
          try {
            // æ—¢å­˜ã®åŒæ§˜ã®Issueã‚’æ¤œç´¢
            const existingIssues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'build-failure,macos'
            });
            
            if (existingIssues.data.length === 0) {
              // æ–°ã—ã„Issueã‚’ä½œæˆ
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: issueBody,
                labels: ['build-failure', 'macos', 'ci-cd']
              });
              console.log('MacOSãƒ“ãƒ«ãƒ‰å¤±æ•—ã®Issueã‚’ä½œæˆã—ã¾ã—ãŸ');
            } else {
              // æ—¢å­˜ã®Issueã«ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: existingIssues.data[0].number,
                body: `## æ–°ã—ã„MacOSãƒ“ãƒ«ãƒ‰å¤±æ•—\n\n${issueBody}`
              });
              console.log('æ—¢å­˜ã®MacOSãƒ“ãƒ«ãƒ‰å¤±æ•—Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            }
          } catch (error) {
            console.error('MacOSãƒ“ãƒ«ãƒ‰å¤±æ•—é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          }

  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: pnpmã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: pnpm/action-setup@v4
      with:
        version: latest
        
    - name: ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å¾©å…ƒ
      uses: actions/cache@v4
      with:
        path: |
          ~/.pnpm-store
          ~/.cargo/registry
          ~/.cargo/git
          src-tauri/target
        key: ${{ runner.os }}-deps-${{ hashFiles('**/pnpm-lock.yaml', '**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-deps-
        
    - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        Write-Host "ğŸ“¦ Windowsç”¨ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..." -ForegroundColor Green
        try {
          pnpm install --frozen-lockfile
          Write-Host "âœ… Windowsä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ" -ForegroundColor Green
        } catch {
          Write-Host "âŒ Windowsä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Red
          Write-Host "::error title=Windowsä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼::pnpmã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          Write-Host "--- pnpmç’°å¢ƒæƒ…å ± ---" -ForegroundColor Yellow
          try { pnpm --version } catch { Write-Host "pnpmãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—" }
          try { node --version } catch { Write-Host "Nodeãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—" }
          Write-Host "--- package.jsonã®ç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Content package.json | Select-Object -First 20 } catch { Write-Host "package.jsonèª­ã¿å–ã‚Šå¤±æ•—" }
          Write-Host "--- pnpm-lock.yamlã®ç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Item pnpm-lock.yaml } catch { Write-Host "pnpm-lock.yamlç¢ºèªå¤±æ•—" }
          exit 1
        }
        
    - name: Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      run: |
        Write-Host "ğŸ¦€ Windowsç”¨Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..." -ForegroundColor Green
        try {
          rustup show
          Write-Host "âœ… Windows Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ" -ForegroundColor Green
        } catch {
          Write-Host "âŒ Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Red
          Write-Host "::error title=Windows Rustã‚¨ãƒ©ãƒ¼::Rustãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          Write-Host "--- Rustç’°å¢ƒæƒ…å ± ---" -ForegroundColor Yellow
          try { rustup --version } catch { Write-Host "rustupãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—" }
          try { rustc --version } catch { Write-Host "rustcãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—" }
          try { cargo --version } catch { Write-Host "cargoãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—å¤±æ•—" }
          exit 1
        }
        
    - name: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
      run: |
        Write-Host "ğŸ—ï¸ Windowsç”¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..." -ForegroundColor Green
        try {
          pnpm build
          Write-Host "âœ… Windowsãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ" -ForegroundColor Green
          Write-Host "--- ãƒ“ãƒ«ãƒ‰æˆæœç‰©ç¢ºèª ---" -ForegroundColor Yellow
          Get-ChildItem -Path "build" -Recurse -ErrorAction SilentlyContinue
        } catch {
          Write-Host "âŒ Windowsãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Red
          Write-Host "::error title=Windowsãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼::SvelteKitãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          Write-Host "--- ãƒ“ãƒ«ãƒ‰ç’°å¢ƒæƒ…å ± ---" -ForegroundColor Yellow
          Write-Host "Node.js: $(node --version)"
          Write-Host "pnpm: $(pnpm --version)"
          Write-Host "--- package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Content package.json | Select-String '"scripts"' -Context 0,10 } catch { Write-Host "ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèªå¤±æ•—" }
          Write-Host "--- ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---" -ForegroundColor Yellow
          try { Get-ChildItem -Path . } catch { Write-Host "ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—" }
          Write-Host "--- viteè¨­å®šç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Content vite.config.js } catch { Write-Host "viteè¨­å®šç¢ºèªå¤±æ•—" }
          exit 1
        }
        
    - name: Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
      run: |
        Write-Host "ğŸš€ Windowsç”¨Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..." -ForegroundColor Green
        $env:TAURI_ENV = "production"
        Write-Host "ç’°å¢ƒå¤‰æ•°è¨­å®š: TAURI_ENV=$env:TAURI_ENV" -ForegroundColor Cyan
        
        # ãƒ“ãƒ«ãƒ‰å‰ã®ç’°å¢ƒç¢ºèª
        Write-Host "--- ãƒ“ãƒ«ãƒ‰å‰ç’°å¢ƒç¢ºèª ---" -ForegroundColor Yellow
        Write-Host "Rust: $(rustc --version)"
        Write-Host "Cargo: $(cargo --version)"
        try { Write-Host "Tauri CLI: $(pnpm tauri --version)" } catch { Write-Host "Tauri CLIç¢ºèªå¤±æ•—" }
        
        # Tauriãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œ
        try {
          # PowerShellã§ã®ãƒ­ã‚°å‡ºåŠ›ã¨ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ
          $buildOutput = pnpm tauri build --bundles msi --verbose 2>&1
          $buildOutput | Out-File -FilePath "$env:TEMP\tauri-build.log" -Encoding UTF8
          Write-Host $buildOutput
          Write-Host "âœ… Windows Tauriãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ" -ForegroundColor Green
        } catch {
          Write-Host "âŒ Windows Tauriãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸ" -ForegroundColor Red
          Write-Host "::error title=Windows Tauriãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼::Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ"
          
          Write-Host "--- è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚° ---" -ForegroundColor Yellow
          try { Get-Content "$env:TEMP\tauri-build.log" | Select-Object -Last 50 } catch { Write-Host "ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šå¤±æ•—" }
          
          Write-Host "--- Tauriè¨­å®šç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Content src-tauri/tauri.conf.json | Select-Object -First 30 } catch { Write-Host "Tauriè¨­å®šç¢ºèªå¤±æ•—" }
          
          Write-Host "--- Cargo.tomlç¢ºèª ---" -ForegroundColor Yellow
          try { Get-Content src-tauri/Cargo.toml } catch { Write-Host "Cargo.tomlç¢ºèªå¤±æ•—" }
          
          Write-Host "--- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---" -ForegroundColor Yellow
          try { Get-ChildItem src-tauri/target/ } catch { Write-Host "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—" }
          
          Write-Host "--- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± ---" -ForegroundColor Yellow
          try { Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion } catch { Write-Host "ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—å¤±æ•—" }
          
          exit 1
        }
        
    - name: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ç¢ºèª
      run: |
        Write-Host "ğŸ“‹ Windowsãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ç¢ºèªä¸­..." -ForegroundColor Green
        
        # ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
        if (-not (Test-Path "src-tauri/target/release/bundle")) {
          Write-Host "âŒ ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“" -ForegroundColor Red
          Write-Host "::error title=Windowsæˆæœç‰©ã‚¨ãƒ©ãƒ¼::ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          Write-Host "--- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€  ---" -ForegroundColor Yellow
          try { Get-ChildItem src-tauri/target -Recurse -Directory | Where-Object { $_.Name -like "*bundle*" } } catch { Write-Host "ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¤œç´¢å¤±æ•—" }
          try { Get-ChildItem src-tauri/target/release/ } catch { Write-Host "ãƒªãƒªãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—" }
          exit 1
        }
        
        # msiãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢
        $msiFiles = Get-ChildItem -Path "src-tauri/target/release/bundle" -Recurse -Filter "*.msi" -ErrorAction SilentlyContinue
        if ($msiFiles.Count -eq 0) {
          Write-Host "âŒ msiãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
          Write-Host "::error title=Windows msiã‚¨ãƒ©ãƒ¼::ç”Ÿæˆã•ã‚ŒãŸmsiãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          Write-Host "--- ãƒãƒ³ãƒ‰ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹ ---" -ForegroundColor Yellow
          try { Get-ChildItem src-tauri/target/release/bundle -Recurse } catch { Write-Host "ãƒãƒ³ãƒ‰ãƒ«å†…å®¹ç¢ºèªå¤±æ•—" }
          Write-Host "--- msiãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª ---" -ForegroundColor Yellow
          try { Get-ChildItem src-tauri/target/release/bundle/msi/ } catch { Write-Host "msiãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèªå¤±æ•—" }
          exit 1
        }
        
        Write-Host "âœ… è¦‹ã¤ã‹ã£ãŸmsiãƒ•ã‚¡ã‚¤ãƒ«:" -ForegroundColor Green
        $msiFiles | ForEach-Object { 
          $size = [math]::Round((Get-Item $_.FullName).Length / 1MB, 2)
          Write-Host "  - $($_.FullName) ($size MB)" -ForegroundColor Cyan
        }

        
    - name: msiãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: windows-msi-${{ github.sha }}
        path: src-tauri/target/release/bundle/msi/*.msi
        if-no-files-found: error
        retention-days: 30
        
    - name: Windowsãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ã®é€šçŸ¥
      if: failure()
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          
          // ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®è©³ç´°æƒ…å ±ã‚’åé›†
          const failureInfo = {
            platform: 'Windows',
            commit: context.sha,
            actor: context.actor,
            runId: context.runId,
            timestamp: new Date().toISOString(),
            branch: context.ref_name || 'unknown'
          };
          
          // Issueä½œæˆã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã§ã‚¨ãƒ©ãƒ¼å ±å‘Š
          const issueTitle = `ğŸš¨ Windowsãƒ“ãƒ«ãƒ‰å¤±æ•— - ${failureInfo.commit.substring(0, 7)}`;
          const issueBody = `## Windowsãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼å ±å‘Š
          
          **ğŸ“‹ ãƒ“ãƒ«ãƒ‰æƒ…å ±**
          - **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ${failureInfo.platform}
          - **ã‚³ãƒŸãƒƒãƒˆ**: ${failureInfo.commit}
          - **ãƒ–ãƒ©ãƒ³ãƒ**: ${failureInfo.branch}
          - **å®Ÿè¡Œè€…**: ${failureInfo.actor}
          - **å¤±æ•—æ™‚åˆ»**: ${failureInfo.timestamp}
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [#${failureInfo.runId}](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${failureInfo.runId})
          
          **ğŸ” ç¢ºèªäº‹é …**
          - [ ] ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼
          - [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] Tauriãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] msiãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼
          - [ ] ç’°å¢ƒè¨­å®šã‚¨ãƒ©ãƒ¼
          
          **ğŸ“ å¯¾å¿œæ–¹æ³•**
          1. ä¸Šè¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒªãƒ³ã‚¯ã‹ã‚‰è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª
          2. ã‚¨ãƒ©ãƒ¼ã®åŸå› ã‚’ç‰¹å®š
          3. å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯è¨­å®šã‚’ä¿®æ­£
          4. ä¿®æ­£å¾Œã«å†åº¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
          
          **âš ï¸ æ³¨æ„**: ã“ã®Issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚è§£æ±ºå¾Œã¯ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ãã ã•ã„ã€‚`;
          
          try {
            // æ—¢å­˜ã®åŒæ§˜ã®Issueã‚’æ¤œç´¢
            const existingIssues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'build-failure,windows'
            });
            
            if (existingIssues.data.length === 0) {
              // æ–°ã—ã„Issueã‚’ä½œæˆ
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: issueBody,
                labels: ['build-failure', 'windows', 'ci-cd']
              });
              console.log('Windowsãƒ“ãƒ«ãƒ‰å¤±æ•—ã®Issueã‚’ä½œæˆã—ã¾ã—ãŸ');
            } else {
              // æ—¢å­˜ã®Issueã«ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: existingIssues.data[0].number,
                body: `## æ–°ã—ã„Windowsãƒ“ãƒ«ãƒ‰å¤±æ•—\n\n${issueBody}`
              });
              console.log('æ—¢å­˜ã®Windowsãƒ“ãƒ«ãƒ‰å¤±æ•—Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            }
          } catch (error) {
            console.error('Windowsãƒ“ãƒ«ãƒ‰å¤±æ•—é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          }

  create-release:
    needs: [build-macos, build-windows]
    runs-on: ubuntu-latest
    if: success() && github.ref_name == 'main' && github.event_name == 'push'
    
    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: MacOSæˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      uses: actions/download-artifact@v4
      with:
        name: macos-dmg-${{ github.sha }}
        path: ./artifacts/macos/
        
    - name: Windowsæˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      uses: actions/download-artifact@v4
      with:
        name: windows-msi-${{ github.sha }}
        path: ./artifacts/windows/
        
    - name: æˆæœç‰©ã®ç¢ºèª
      run: |
        echo "ğŸ“‹ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸæˆæœç‰©ã‚’ç¢ºèªä¸­..."
        
        # æˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å­˜åœ¨ç¢ºèª
        if [ ! -d "./artifacts" ]; then
          echo "âŒ æˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"
          echo "::error title=ãƒªãƒªãƒ¼ã‚¹æˆæœç‰©ã‚¨ãƒ©ãƒ¼::æˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        
        # dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
        DMG_COUNT=$(find ./artifacts -type f -name "*.dmg" | wc -l)
        MSI_COUNT=$(find ./artifacts -type f -name "*.msi" | wc -l)
        
        echo "è¦‹ã¤ã‹ã£ãŸæˆæœç‰©:"
        echo "  - dmgãƒ•ã‚¡ã‚¤ãƒ«: $DMG_COUNT å€‹"
        echo "  - msiãƒ•ã‚¡ã‚¤ãƒ«: $MSI_COUNT å€‹"
        
        if [ "$DMG_COUNT" -eq 0 ]; then
          echo "âŒ dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          echo "::error title=MacOSæˆæœç‰©ã‚¨ãƒ©ãƒ¼::dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"
          echo "--- MacOSæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹ ---"
          ls -la ./artifacts/macos/ || echo "MacOSæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"
          exit 1
        fi
        
        if [ "$MSI_COUNT" -eq 0 ]; then
          echo "âŒ msiãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          echo "::error title=Windowsæˆæœç‰©ã‚¨ãƒ©ãƒ¼::msiãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"
          echo "--- Windowsæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹ ---"
          ls -la ./artifacts/windows/ || echo "Windowsæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“"
          exit 1
        fi
        
        echo "âœ… ã™ã¹ã¦ã®æˆæœç‰©ãŒæ­£å¸¸ã«ç¢ºèªã•ã‚Œã¾ã—ãŸ"
        find ./artifacts -type f -name "*.dmg" -o -name "*.msi" | while read file; do
          echo "  - $file ($(du -h "$file" | cut -f1))"
        done
        
    - name: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã®è‡ªå‹•ç”Ÿæˆã¨æ¤œè¨¼
      id: version-tag
      run: |
        echo "ğŸ·ï¸ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã‚’è‡ªå‹•ç”Ÿæˆä¸­..."
        
        # package.jsonã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
        VERSION=$(node -p "require('./package.json').version")
        RELEASE_TAG="v${VERSION}"
        COMMIT_SHORT="${{ github.sha }}"
        COMMIT_SHORT="${COMMIT_SHORT:0:7}"
        
        # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¿ã‚°ã‚’ç”Ÿæˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        TIMESTAMP=$(date +%Y%m%d-%H%M%S)
        
        echo "ğŸ“‹ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±:"
        echo "  - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${VERSION}"
        echo "  - ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°: ${RELEASE_TAG}"
        echo "  - ã‚³ãƒŸãƒƒãƒˆ: ${COMMIT_SHORT}"
        echo "  - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${TIMESTAMP}"
        
        # ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®š
        echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT
        echo "RELEASE_TAG=${RELEASE_TAG}" >> $GITHUB_OUTPUT
        echo "COMMIT_SHORT=${COMMIT_SHORT}" >> $GITHUB_OUTPUT
        echo "TIMESTAMP=${TIMESTAMP}" >> $GITHUB_OUTPUT
        
        # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
        if [[ ! "$VERSION" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
          echo "âŒ ç„¡åŠ¹ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³å½¢å¼: $VERSION"
          echo "::error title=ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼::package.jsonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        
        echo "âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ: ${RELEASE_TAG}"
        
    - name: ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ GitHubãƒªãƒªãƒ¼ã‚¹ã®ä½œæˆ
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const fs = require('fs');
          const path = require('path');
          const { execSync } = require('child_process');
          
          // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®å–å¾—
          const version = '${{ steps.version-tag.outputs.VERSION }}';
          const releaseTag = '${{ steps.version-tag.outputs.RELEASE_TAG }}';
          const commitShort = '${{ steps.version-tag.outputs.COMMIT_SHORT }}';
          const timestamp = '${{ steps.version-tag.outputs.TIMESTAMP }}';
          const releaseName = `ã‚ªãƒ©ã®çµŒè²»ã ã‚¾ ${releaseTag}`;
          
          console.log(`ğŸš€ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ä½œæˆé–‹å§‹: ${releaseTag}`);
          
          // æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°æ¤œç´¢ã¨æ¤œè¨¼
          console.log('ğŸ“¦ æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ä¸­...');
          
          let dmgFiles, msiFiles;
          try {
            dmgFiles = execSync('find ./artifacts/macos -name "*.dmg" -type f').toString().trim().split('\n').filter(f => f);
            msiFiles = execSync('find ./artifacts/windows -name "*.msi" -type f').toString().trim().split('\n').filter(f => f);
          } catch (error) {
            console.error('æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            throw new Error('æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
          
          // æˆæœç‰©ã®å­˜åœ¨ç¢ºèª
          if (dmgFiles.length === 0) {
            console.error('âŒ dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            console.error('MacOSæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹:');
            try {
              execSync('ls -la ./artifacts/macos/');
            } catch (e) {
              console.error('MacOSæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“');
            }
            throw new Error('dmgãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          }
          
          if (msiFiles.length === 0) {
            console.error('âŒ msiãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            console.error('Windowsæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹:');
            try {
              execSync('ls -la ./artifacts/windows/');
            } catch (e) {
              console.error('Windowsæˆæœç‰©ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã›ã‚“');
            }
            throw new Error('msiãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          }
          
          const dmgPath = dmgFiles[0];
          const msiPath = msiFiles[0];
          const dmgName = path.basename(dmgPath);
          const msiName = path.basename(msiPath);
          
          // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ç¢ºèª
          const dmgStats = fs.statSync(dmgPath);
          const msiStats = fs.statSync(msiPath);
          const dmgSizeMB = (dmgStats.size / 1024 / 1024).toFixed(2);
          const msiSizeMB = (msiStats.size / 1024 / 1024).toFixed(2);
          
          console.log('âœ… æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ãŒç¢ºèªã•ã‚Œã¾ã—ãŸ:');
          console.log(`  - MacOS dmg: ${dmgName} (${dmgSizeMB} MB)`);
          console.log(`  - Windows msi: ${msiName} (${msiSizeMB} MB)`);
          
          // æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ã®ç¢ºèªã¨å‡¦ç†
          let existingRelease = null;
          try {
            existingRelease = await github.rest.repos.getReleaseByTag({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag: releaseTag
            });
            console.log(`âš ï¸ æ—¢å­˜ã®ãƒªãƒªãƒ¼ã‚¹ ${releaseTag} ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
            
            // æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆ
            console.log('ğŸ—‘ï¸ æ—¢å­˜ãƒªãƒªãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™...');
            await github.rest.repos.deleteRelease({
              owner: context.repo.owner,
              repo: context.repo.repo,
              release_id: existingRelease.data.id
            });
            
            // ã‚¿ã‚°ã‚‚å‰Šé™¤
            try {
              await github.rest.git.deleteRef({
                owner: context.repo.owner,
                repo: context.repo.repo,
                ref: `tags/${releaseTag}`
              });
            } catch (tagError) {
              console.log('ã‚¿ã‚°ã®å‰Šé™¤ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸï¼ˆå­˜åœ¨ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰');
            }
            
          } catch (error) {
            console.log(`âœ¨ æ–°ã—ã„ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ ${releaseTag} ã‚’ä½œæˆã—ã¾ã™`);
          }
          
          // å‰å›ã®ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ã®å¤‰æ›´å±¥æ­´ã‚’å–å¾—ã—ã¦ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ
          console.log('ğŸ“ ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆä¸­...');
          
          let changelogSection = '';
          let commitInfo = '';
          
          try {
            // æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
            const commit = await github.rest.repos.getCommit({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ref: context.sha
            });
            commitInfo = commit.data.commit.message.split('\n')[0]; // æœ€åˆã®è¡Œã®ã¿
            
            // å‰å›ã®ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°ã‚’å–å¾—
            let previousTag = null;
            try {
              const releases = await github.rest.repos.listReleases({
                owner: context.repo.owner,
                repo: context.repo.repo,
                per_page: 10
              });
              
              // ç¾åœ¨ã®ã‚¿ã‚°ä»¥å¤–ã®æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã‚’æ¢ã™
              const previousRelease = releases.data.find(r => r.tag_name !== releaseTag);
              if (previousRelease) {
                previousTag = previousRelease.tag_name;
                console.log(`ğŸ“‹ å‰å›ã®ãƒªãƒªãƒ¼ã‚¹: ${previousTag}`);
              }
            } catch (error) {
              console.log('å‰å›ã®ãƒªãƒªãƒ¼ã‚¹æƒ…å ±ã®å–å¾—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
            }
            
            // å‰å›ã®ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ã®å¤‰æ›´å±¥æ­´ã‚’å–å¾—
            if (previousTag) {
              try {
                const comparison = await github.rest.repos.compareCommits({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  base: previousTag,
                  head: context.sha
                });
                
                const commits = comparison.data.commits;
                console.log(`ğŸ“Š ${previousTag}ã‹ã‚‰ã®å¤‰æ›´: ${commits.length}ä»¶ã®ã‚³ãƒŸãƒƒãƒˆ`);
                
                if (commits.length > 0) {
                  // ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†é¡
                  const features = [];
                  const fixes = [];
                  const improvements = [];
                  const others = [];
                  
                  commits.forEach(commit => {
                    const message = commit.commit.message.split('\n')[0];
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('feat') || lowerMessage.includes('feature') || lowerMessage.includes('æ–°æ©Ÿèƒ½') || lowerMessage.includes('è¿½åŠ ')) {
                      features.push(`- ${message} (${commit.sha.substring(0, 7)})`);
                    } else if (lowerMessage.includes('fix') || lowerMessage.includes('bug') || lowerMessage.includes('ä¿®æ­£') || lowerMessage.includes('ãƒã‚°')) {
                      fixes.push(`- ${message} (${commit.sha.substring(0, 7)})`);
                    } else if (lowerMessage.includes('improve') || lowerMessage.includes('update') || lowerMessage.includes('æ”¹å–„') || lowerMessage.includes('æ›´æ–°')) {
                      improvements.push(`- ${message} (${commit.sha.substring(0, 7)})`);
                    } else {
                      others.push(`- ${message} (${commit.sha.substring(0, 7)})`);
                    }
                  });
                  
                  // å¤‰æ›´å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰
                  changelogSection = '\n### ğŸ“ å¤‰æ›´å±¥æ­´\n\n';
                  
                  if (features.length > 0) {
                    changelogSection += '#### ğŸ†• æ–°æ©Ÿèƒ½\n' + features.join('\n') + '\n\n';
                  }
                  
                  if (improvements.length > 0) {
                    changelogSection += '#### âš¡ æ”¹å–„ãƒ»æ›´æ–°\n' + improvements.join('\n') + '\n\n';
                  }
                  
                  if (fixes.length > 0) {
                    changelogSection += '#### ğŸ› ãƒã‚°ä¿®æ­£\n' + fixes.join('\n') + '\n\n';
                  }
                  
                  if (others.length > 0) {
                    changelogSection += '#### ğŸ”§ ãã®ä»–ã®å¤‰æ›´\n' + others.join('\n') + '\n\n';
                  }
                  
                  // çµ±è¨ˆæƒ…å ±ã‚’è¿½åŠ 
                  changelogSection += `#### ğŸ“Š å¤‰æ›´çµ±è¨ˆ\n`;
                  changelogSection += `- **ç·ã‚³ãƒŸãƒƒãƒˆæ•°**: ${commits.length}\n`;
                  changelogSection += `- **æ–°æ©Ÿèƒ½**: ${features.length}\n`;
                  changelogSection += `- **æ”¹å–„ãƒ»æ›´æ–°**: ${improvements.length}\n`;
                  changelogSection += `- **ãƒã‚°ä¿®æ­£**: ${fixes.length}\n`;
                  changelogSection += `- **ãã®ä»–**: ${others.length}\n`;
                  
                  // ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´çµ±è¨ˆ
                  if (comparison.data.files && comparison.data.files.length > 0) {
                    const totalAdditions = comparison.data.files.reduce((sum, file) => sum + file.additions, 0);
                    const totalDeletions = comparison.data.files.reduce((sum, file) => sum + file.deletions, 0);
                    const changedFiles = comparison.data.files.length;
                    
                    changelogSection += `- **å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: ${changedFiles}\n`;
                    changelogSection += `- **è¿½åŠ è¡Œæ•°**: +${totalAdditions}\n`;
                    changelogSection += `- **å‰Šé™¤è¡Œæ•°**: -${totalDeletions}\n`;
                  }
                  
                } else {
                  changelogSection = '\n### ğŸ“ å¤‰æ›´å±¥æ­´\n\nåˆå›ãƒªãƒªãƒ¼ã‚¹ã¾ãŸã¯å¤‰æ›´ãªã—\n';
                }
                
              } catch (comparisonError) {
                console.log('å¤‰æ›´å±¥æ­´ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', comparisonError.message);
                changelogSection = '\n### ğŸ“ å¤‰æ›´å±¥æ­´\n\nå¤‰æ›´å±¥æ­´ã®è‡ªå‹•ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ\n';
              }
            } else {
              changelogSection = '\n### ğŸ“ å¤‰æ›´å±¥æ­´\n\nåˆå›ãƒªãƒªãƒ¼ã‚¹\n';
            }
            
          } catch (error) {
            console.log('ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error.message);
            commitInfo = 'ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
            changelogSection = '\n### ğŸ“ å¤‰æ›´å±¥æ­´\n\nãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ\n';
          }
          
          // ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã®è©³ç´°ãªãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
          const releaseNotes = `## ğŸ‰ æ–°ã—ã„ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹: ${releaseTag}

### ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | ãƒ•ã‚¡ã‚¤ãƒ« | ã‚µã‚¤ã‚º | å¯¾å¿œOS |
|---|---|---|---|
| **MacOS** | ${dmgName} | ${dmgSizeMB} MB | macOS 10.15+ |
| **Windows** | ${msiName} | ${msiSizeMB} MB | Windows 10+ |

### ğŸ“‹ ãƒ“ãƒ«ãƒ‰æƒ…å ±
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ${version}
- **ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚°**: ${releaseTag}
- **ã‚³ãƒŸãƒƒãƒˆ**: ${context.sha} (${commitShort})
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ${commitInfo}
- **ãƒ“ãƒ«ãƒ‰æ—¥æ™‚**: ${new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })} (JST)
- **ãƒ“ãƒ«ãƒ‰è€…**: ${context.actor}
- **ãƒ–ãƒ©ãƒ³ãƒ**: ${context.ref_name || 'main'}
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: [GitHub Actions #${context.runId}](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})
${changelogSection}
### ğŸ”§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

#### MacOS
1. **${dmgName}** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¦ãƒ³ãƒˆ
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Applicationsãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
4. Launchpadã¾ãŸã¯ã€Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

#### Windows
1. **${msiName}** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. msiãƒ•ã‚¡ã‚¤ãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã€ã‚’é¸æŠ
3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã«å¾“ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
4. ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¾ãŸã¯ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

### âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã«ã¤ã„ã¦
- **MacOS**: åˆå›èµ·å‹•æ™‚ã«ã€Œé–‹ç™ºå…ƒãŒæœªç¢ºèªã®ãŸã‚é–‹ã‘ã¾ã›ã‚“ã€ã¨ã„ã†è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
  - å¯¾å‡¦æ³•: ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒè¨­å®š > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ > ä¸€èˆ¬ > ã€Œã“ã®ã¾ã¾é–‹ãã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- **Windows**: SmartScreenã®è­¦å‘Šã€ŒWindowsã«ã‚ˆã£ã¦PCãŒä¿è­·ã•ã‚Œã¾ã—ãŸã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
  - å¯¾å‡¦æ³•: ã€Œè©³ç´°æƒ…å ±ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œå®Ÿè¡Œã€ã‚’é¸æŠ

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ**: é–‹ç™ºç’°å¢ƒã¨ã¯åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆexpenses.dbï¼‰ãŒä½¿ç”¨ã•ã‚Œã¾ã™
- **ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ**: é–‹ç™ºç‰ˆã‹ã‚‰æœ¬ãƒªãƒªãƒ¼ã‚¹ç‰ˆã¸ã®ç§»è¡Œæ™‚ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã¯å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™

#### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- **MacOS**: macOS 10.15 (Catalina) ä»¥é™
- **Windows**: Windows 10 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1903 ä»¥é™
- **ãƒ¡ãƒ¢ãƒª**: æœ€ä½ 4GB RAM æ¨å¥¨
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: æœ€ä½ 100MB ã®ç©ºãå®¹é‡

### ğŸ› ï¸ æŠ€è¡“æƒ…å ±
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Tauri v1.x + SvelteKit
- **è¨€èª**: Rust (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰) + TypeScript (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
- **ãƒ“ãƒ«ãƒ‰ç’°å¢ƒ**: GitHub Actions (MacOS runner + Windows runner)
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: pnpm
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLite (ç’°å¢ƒåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é›¢)
- **UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Svelte 5 + TypeScript

### ğŸ› å•é¡Œå ±å‘Šãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã‚„æ©Ÿèƒ½è¦æœ›ãŒã‚ã‚‹å ´åˆã¯ã€[Issues](https://github.com/${context.repo.owner}/${context.repo.repo}/issues) ã‹ã‚‰ã”å ±å‘Šãã ã•ã„ã€‚

### ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ç’°å¢ƒè¨­å®šã‚¬ã‚¤ãƒ‰](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/ENVIRONMENT_SETUP.md)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/TROUBLESHOOTING.md)
- [R2è¨­å®šã‚¬ã‚¤ãƒ‰](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/docs/R2_SETUP.md)`;
          
          // ãƒªãƒªãƒ¼ã‚¹ã®ä½œæˆ
          console.log('ğŸ“ GitHubãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆä¸­...');
          const release = await github.rest.repos.createRelease({
            owner: context.repo.owner,
            repo: context.repo.repo,
            tag_name: releaseTag,
            name: releaseName,
            body: releaseNotes,
            draft: false,
            prerelease: false,
            generate_release_notes: false // æ‰‹å‹•ã§ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãŸã‚
          });
          
          console.log(`âœ… ãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã—ãŸ: ${release.data.html_url}`);
          
          // dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          console.log('ğŸ“¤ MacOS dmgãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...');
          try {
            const dmgContent = fs.readFileSync(dmgPath);
            const dmgUpload = await github.rest.repos.uploadReleaseAsset({
              owner: context.repo.owner,
              repo: context.repo.repo,
              release_id: release.data.id,
              name: dmgName,
              data: dmgContent,
              headers: {
                'content-type': 'application/octet-stream',
                'content-length': dmgStats.size
              }
            });
            console.log(`âœ… dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ: ${dmgUpload.data.browser_download_url}`);
          } catch (error) {
            console.error('âŒ dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            throw new Error(`dmgãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—: ${error.message}`);
          }
          
          // msiãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          console.log('ğŸ“¤ Windows msiãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...');
          try {
            const msiContent = fs.readFileSync(msiPath);
            const msiUpload = await github.rest.repos.uploadReleaseAsset({
              owner: context.repo.owner,
              repo: context.repo.repo,
              release_id: release.data.id,
              name: msiName,
              data: msiContent,
              headers: {
                'content-type': 'application/octet-stream',
                'content-length': msiStats.size
              }
            });
            console.log(`âœ… msiãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ: ${msiUpload.data.browser_download_url}`);
          } catch (error) {
            console.error('âŒ msiãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            throw new Error(`msiãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—: ${error.message}`);
          }
          
          // ãƒªãƒªãƒ¼ã‚¹ä½œæˆã®æœ€çµ‚ç¢ºèª
          const finalRelease = await github.rest.repos.getRelease({
            owner: context.repo.owner,
            repo: context.repo.repo,
            release_id: release.data.id
          });
          
          const assetCount = finalRelease.data.assets.length;
          console.log(`ğŸ¯ ãƒªãƒªãƒ¼ã‚¹ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ:`);
          console.log(`   - ãƒªãƒªãƒ¼ã‚¹URL: ${finalRelease.data.html_url}`);
          console.log(`   - ã‚¿ã‚°: ${finalRelease.data.tag_name}`);
          console.log(`   - ã‚¢ã‚»ãƒƒãƒˆæ•°: ${assetCount}/2`);
          
          if (assetCount !== 2) {
            throw new Error(`æœŸå¾…ã•ã‚Œã‚‹ã‚¢ã‚»ãƒƒãƒˆæ•°(2)ã¨å®Ÿéš›ã®ã‚¢ã‚»ãƒƒãƒˆæ•°(${assetCount})ãŒä¸€è‡´ã—ã¾ã›ã‚“`);
          }
          
          console.log('ğŸ‰ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼');
          
          // ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥ã®é€ä¿¡
          console.log('ğŸ“¢ ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥ã‚’é€ä¿¡ä¸­...');
          
          // ãƒªãƒªãƒ¼ã‚¹å®Œäº†ã®Issueã¾ãŸã¯Discussionã‚’ä½œæˆ
          try {
            const notificationTitle = `ğŸ‰ ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥: ${releaseTag}`;
            const notificationBody = `## âœ… ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸ

**ğŸ¯ ãƒªãƒªãƒ¼ã‚¹æƒ…å ±**
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ${releaseTag}
- **ãƒªãƒªãƒ¼ã‚¹URL**: ${finalRelease.data.html_url}
- **å®Œäº†æ™‚åˆ»**: ${new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })} (JST)

**ğŸ“¦ æˆæœç‰©**
- MacOS dmg: ${dmgName} (${dmgSizeMB} MB)
- Windows msi: ${msiName} (${msiSizeMB} MB)

**ğŸ‘¥ é–¢ä¿‚è€…ã¸ã®é€šçŸ¥**
@${context.actor} ãƒªãƒªãƒ¼ã‚¹ä½œæˆè€…
${context.payload.pusher ? `@${context.payload.pusher.name} ãƒ—ãƒƒã‚·ãƒ¥å®Ÿè¡Œè€…` : ''}

**ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**
- [ ] ãƒªãƒªãƒ¼ã‚¹ã®å‹•ä½œç¢ºèª
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

ã“ã®ãƒªãƒªãƒ¼ã‚¹ã«é–¢ã™ã‚‹è³ªå•ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ã“ã®Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚`;

            // é€šçŸ¥ç”¨ã®Issueã‚’ä½œæˆ
            const notificationIssue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: notificationTitle,
              body: notificationBody,
              labels: ['release-notification', 'completed', 'cross-platform'],
              assignees: [context.actor] // ãƒªãƒªãƒ¼ã‚¹ä½œæˆè€…ã‚’ã‚¢ã‚µã‚¤ãƒ³
            });
            
            console.log(`âœ… ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥ãŒä½œæˆã•ã‚Œã¾ã—ãŸ: ${notificationIssue.data.html_url}`);
            
          } catch (notificationError) {
            console.error('âš ï¸ ãƒªãƒªãƒ¼ã‚¹å®Œäº†é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒªãƒªãƒ¼ã‚¹è‡ªä½“ã¯æˆåŠŸã—ã¦ã„ã¾ã™:', notificationError.message);
          }
          
    - name: ãƒªãƒªãƒ¼ã‚¹ä½œæˆå¤±æ•—æ™‚ã®é€šçŸ¥
      if: failure()
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          
          // ãƒªãƒªãƒ¼ã‚¹å¤±æ•—ã®è©³ç´°æƒ…å ±ã‚’åé›†
          const failureInfo = {
            process: 'Release Creation',
            commit: context.sha,
            actor: context.actor,
            runId: context.runId,
            timestamp: new Date().toISOString(),
            branch: context.ref_name || 'unknown'
          };
          
          // Issueä½œæˆã§ã‚¨ãƒ©ãƒ¼å ±å‘Š
          const issueTitle = `ğŸš¨ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ä½œæˆå¤±æ•— - ${failureInfo.commit.substring(0, 7)}`;
          const issueBody = `## ãƒªãƒªãƒ¼ã‚¹ä½œæˆã‚¨ãƒ©ãƒ¼å ±å‘Š
          
          **ğŸ“‹ ãƒªãƒªãƒ¼ã‚¹æƒ…å ±**
          - **ãƒ—ãƒ­ã‚»ã‚¹**: ${failureInfo.process}
          - **ã‚³ãƒŸãƒƒãƒˆ**: ${failureInfo.commit}
          - **ãƒ–ãƒ©ãƒ³ãƒ**: ${failureInfo.branch}
          - **å®Ÿè¡Œè€…**: ${failureInfo.actor}
          - **å¤±æ•—æ™‚åˆ»**: ${failureInfo.timestamp}
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [#${failureInfo.runId}](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${failureInfo.runId})
          
          **ğŸ” ç¢ºèªäº‹é …**
          - [ ] æˆæœç‰©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] GitHubãƒªãƒªãƒ¼ã‚¹ä½œæˆã‚¨ãƒ©ãƒ¼
          - [ ] ã‚¢ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼
          - [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼
          - [ ] æ¨©é™ã‚¨ãƒ©ãƒ¼
          
          **ğŸ“ å¯¾å¿œæ–¹æ³•**
          1. ä¸Šè¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒªãƒ³ã‚¯ã‹ã‚‰è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª
          2. MacOSã¨Windowsãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
          3. GitHub Actionsã®æ¨©é™è¨­å®šã‚’ç¢ºèª
          4. å¿…è¦ã«å¿œã˜ã¦æ‰‹å‹•ã§ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆ
          
          **âš ï¸ æ³¨æ„**: ã“ã®Issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚è§£æ±ºå¾Œã¯ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ãã ã•ã„ã€‚`;
          
          try {
            // ãƒªãƒªãƒ¼ã‚¹å¤±æ•—ã®Issueã‚’ä½œæˆ
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: issueTitle,
              body: issueBody,
              labels: ['release-failure', 'ci-cd', 'urgent']
            });
            console.log('ãƒªãƒªãƒ¼ã‚¹ä½œæˆå¤±æ•—ã®Issueã‚’ä½œæˆã—ã¾ã—ãŸ');
          } catch (error) {
            console.error('ãƒªãƒªãƒ¼ã‚¹ä½œæˆå¤±æ•—é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          }

  # éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®æ¤œå‡ºã¨é€šçŸ¥
  check-partial-failure:
    needs: [build-macos, build-windows]
    runs-on: ubuntu-latest
    if: always() && (needs.build-macos.result == 'failure' || needs.build-windows.result == 'failure')
    
    steps:
    - name: éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®é€šçŸ¥
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          
          // å„ãƒ“ãƒ«ãƒ‰ã®çµæœã‚’ç¢ºèª
          const macosResult = '${{ needs.build-macos.result }}';
          const windowsResult = '${{ needs.build-windows.result }}';
          
          let failedPlatforms = [];
          let successPlatforms = [];
          
          if (macosResult === 'failure') {
            failedPlatforms.push('MacOS');
          } else if (macosResult === 'success') {
            successPlatforms.push('MacOS');
          }
          
          if (windowsResult === 'failure') {
            failedPlatforms.push('Windows');
          } else if (windowsResult === 'success') {
            successPlatforms.push('Windows');
          }
          
          // éƒ¨åˆ†çš„å¤±æ•—ã®å ´åˆã®ã¿å‡¦ç†
          if (failedPlatforms.length > 0 && successPlatforms.length > 0) {
            const issueTitle = `âš ï¸ éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•— - ${context.sha.substring(0, 7)}`;
            const issueBody = `## éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•—å ±å‘Š
            
            **ğŸ“‹ ãƒ“ãƒ«ãƒ‰çŠ¶æ³**
            - **æˆåŠŸã—ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ${successPlatforms.join(', ')}
            - **å¤±æ•—ã—ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ${failedPlatforms.join(', ')}
            - **ã‚³ãƒŸãƒƒãƒˆ**: ${context.sha}
            - **ãƒ–ãƒ©ãƒ³ãƒ**: ${context.ref_name || 'unknown'}
            - **å®Ÿè¡Œè€…**: ${context.actor}
            - **å¤±æ•—æ™‚åˆ»**: ${new Date().toISOString()}
            - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [#${context.runId}](https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})
            
            **ğŸš¨ å½±éŸ¿**
            - ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ
            - ${successPlatforms.join(', ')}ã®ãƒ“ãƒ«ãƒ‰ã¯æˆåŠŸã—ã¾ã—ãŸãŒã€${failedPlatforms.join(', ')}ã®ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ãŸãŸã‚ã€ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ
            
            **ğŸ“ å¯¾å¿œæ–¹æ³•**
            1. å¤±æ•—ã—ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆ${failedPlatforms.join(', ')}ï¼‰ã®ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’ç¢ºèª
            2. ã‚¨ãƒ©ãƒ¼ã®åŸå› ã‚’ç‰¹å®šã—ã¦ä¿®æ­£
            3. ä¿®æ­£å¾Œã«å†åº¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
            4. ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãŸã‚‰ã€è‡ªå‹•çš„ã«ãƒªãƒªãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™
            
            **âš ï¸ æ³¨æ„**: ã“ã®Issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãŸã‚‰ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ãã ã•ã„ã€‚`;
            
            try {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: issueBody,
                labels: ['partial-build-failure', 'ci-cd', 'cross-platform']
              });
              console.log('éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•—ã®Issueã‚’ä½œæˆã—ã¾ã—ãŸ');
            } catch (error) {
              console.error('éƒ¨åˆ†çš„ãƒ“ãƒ«ãƒ‰å¤±æ•—é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          } else if (failedPlatforms.length === 2) {
            console.log('ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸï¼ˆå€‹åˆ¥ã®é€šçŸ¥ãŒæ—¢ã«ä½œæˆã•ã‚Œã¦ã„ã¾ã™ï¼‰');
          } else {
            console.log('ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ã¾ã—ãŸ');
          }

  # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®ç›£è¦–ã¨çµ±åˆå ±å‘Š
  workflow-summary:
    needs: [build-macos, build-windows, create-release]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œçµæœã®çµ±åˆå ±å‘Š
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { context } = require('@actions/github');
          
          // å„ã‚¸ãƒ§ãƒ–ã®çµæœã‚’åé›†
          const results = {
            macos: '${{ needs.build-macos.result }}',
            windows: '${{ needs.build-windows.result }}',
            release: '${{ needs.create-release.result }}'
          };
          
          // çµ±è¨ˆæƒ…å ±ã®è¨ˆç®—
          const totalJobs = Object.keys(results).length;
          const successJobs = Object.values(results).filter(r => r === 'success').length;
          const failedJobs = Object.values(results).filter(r => r === 'failure').length;
          const skippedJobs = Object.values(results).filter(r => r === 'skipped').length;
          
          // å®Ÿè¡Œæ™‚é–“ã®è¨ˆç®—ï¼ˆæ¦‚ç®—ï¼‰
          const workflowStartTime = new Date(context.payload.head_commit?.timestamp || new Date());
          const currentTime = new Date();
          const executionTime = Math.round((currentTime - workflowStartTime) / 1000 / 60); // åˆ†å˜ä½
          
          console.log('='.repeat(60));
          console.log('ğŸ¯ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ CI/CDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œçµæœ');
          console.log('='.repeat(60));
          console.log(`ğŸ“Š å®Ÿè¡Œçµ±è¨ˆ:`);
          console.log(`   - ç·ã‚¸ãƒ§ãƒ–æ•°: ${totalJobs}`);
          console.log(`   - æˆåŠŸ: ${successJobs}`);
          console.log(`   - å¤±æ•—: ${failedJobs}`);
          console.log(`   - ã‚¹ã‚­ãƒƒãƒ—: ${skippedJobs}`);
          console.log(`   - å®Ÿè¡Œæ™‚é–“: ç´„${executionTime}åˆ†`);
          console.log('');
          console.log(`ğŸ“‹ è©³ç´°çµæœ:`);
          console.log(`   - MacOSãƒ“ãƒ«ãƒ‰: ${results.macos}`);
          console.log(`   - Windowsãƒ“ãƒ«ãƒ‰: ${results.windows}`);
          console.log(`   - ãƒªãƒªãƒ¼ã‚¹ä½œæˆ: ${results.release}`);
          console.log('');
          
          // å…¨ä½“çš„ãªæˆåŠŸ/å¤±æ•—ã®åˆ¤å®š
          if (successJobs === totalJobs) {
            console.log('âœ… ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼');
            console.log('ğŸ‰ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒªãƒªãƒ¼ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ');
          } else if (failedJobs > 0) {
            console.log('âŒ ä¸€éƒ¨ã¾ãŸã¯ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤±æ•—ã—ã¾ã—ãŸ');
            console.log('ğŸ” è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯å„ã‚¸ãƒ§ãƒ–ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
          } else {
            console.log('âš ï¸ ä¸€éƒ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ');
          }
          
          console.log('');
          console.log(`ğŸ”— ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ: https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`);
          console.log('='.repeat(60));