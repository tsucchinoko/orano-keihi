# 実装計画: Tauri自動アップデート機能

## 概要

Tauri v2のupdaterプラグインを使用して、GitHub Releasesの静的JSONファイルベースの自動アップデート機能を実装する。現在の動的エンドポイント方式から静的JSONファイル方式に変更し、より信頼性の高いアップデート配信システムを構築する。

## タスク

- [x] 1. Tauri設定の更新と静的JSONエンドポイント設定
  - tauri.conf.jsonのupdaterプラグイン設定を静的JSONファイル方式に変更
  - GitHub Releasesの静的JSONファイルエンドポイントを設定
  - _要件: 4.1, 4.3_

- [-] 2. 静的JSONファイル生成スクリプトの実装
  - [x] 2.1 JSONファイル生成スクリプトの作成
    - Node.jsスクリプトでプラットフォーム・アーキテクチャ別のJSONファイルを生成
    - バージョン情報、ダウンロードURL、署名情報、リリースノートを含む
    - _要件: 4.1, 4.2_

  - [ ]* 2.2 JSONファイル生成のプロパティテスト
    - **プロパティ 5: JSONファイル生成の完全性**
    - **検証対象: 要件 4.2, 4.4, 4.5**

- [x] 3. GitHub Actionsワークフローの拡張
  - [x] 3.1 リリースワークフローにJSONファイル生成ステップを追加
    - 既存のrelease.ymlワークフローを拡張
    - 各プラットフォーム用のJSONファイル生成と配置
    - _要件: 4.1, 4.3_

  - [ ]* 3.2 ワークフロー統合テスト
    - JSONファイルがGitHub Releasesに正しくアップロードされることを確認
    - _要件: 4.3_

- [x] 4. Rustバックエンドのアップデート機能強化
  - [x] 4.1 UpdaterConfigの実装
    - ユーザー設定を管理する構造体とメソッドを実装
    - 設定の永続化機能を追加
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ]* 4.2 設定永続性のプロパティテスト
    - **プロパティ 3: 設定の永続性**
    - **検証対象: 要件 7.5**

  - [x] 4.3 UpdaterServiceの機能拡張
    - 設定管理機能の追加
    - エラーハンドリングの改善
    - ログ機能の実装
    - _要件: 1.1, 1.2, 6.1, 6.2, 6.3, 6.4, 6.5_

  - [ ]* 4.4 アップデートチェック冪等性のプロパティテスト
    - **プロパティ 1: アップデートチェックの冪等性**
    - **検証対象: 要件 1.2**

  - [ ]* 4.5 エラーハンドリングのプロパティテスト
    - **プロパティ 4: エラー時の包括的処理**
    - **検証対象: 要件 6.1, 6.2, 6.3, 6.4, 6.5**

- [ ] 5. セキュリティ機能の実装
  - [ ] 5.1 署名検証とセキュリティチェックの強化
    - デジタル署名検証の実装
    - HTTPS通信の強制
    - ハッシュ値検証の追加
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

  - [ ]* 5.2 セキュリティ検証のプロパティテスト
    - **プロパティ 2: セキュリティ検証の包括性**
    - **検証対象: 要件 5.1, 5.2, 5.3, 5.4**

- [ ] 6. チェックポイント - バックエンド機能の確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば尋ねる

- [ ] 7. TypeScriptフロントエンドのUI改善
  - [ ] 7.1 UpdaterServiceの機能拡張
    - 設定管理機能の追加
    - バージョン比較ロジックの改善
    - _要件: 2.1, 7.1, 7.2, 7.3, 7.4_

  - [ ]* 7.2 バージョン比較のプロパティテスト
    - **プロパティ 6: バージョン比較の推移性**
    - **検証対象: 要件 2.1**

  - [ ] 7.3 UpdateNotificationコンポーネントの改善
    - スキップ機能の追加
    - エラー表示の改善
    - プログレス表示の強化
    - _要件: 2.2, 2.3, 2.4, 2.5, 3.2_

  - [ ]* 7.4 UI要素のプロパティテスト
    - **プロパティ 8: UI要素の情報完全性**
    - **検証対象: 要件 2.2**

  - [ ]* 7.5 ダウンロード進捗のプロパティテスト
    - **プロパティ 7: ダウンロード進捗の単調性**
    - **検証対象: 要件 3.2**

  - [ ]* 7.6 ユーザー選択状態管理のプロパティテスト
    - **プロパティ 9: ユーザー選択の状態管理**
    - **検証対象: 要件 2.4, 2.5, 7.4**

- [ ] 8. 設定画面の実装
  - [ ] 8.1 アップデート設定画面の作成
    - 自動チェック有効/無効の設定
    - チェック頻度の設定
    - ベータ版受信設定
    - _要件: 7.1, 7.2, 7.3_

  - [ ]* 8.2 設定画面の単体テスト
    - 設定変更の動作確認
    - _要件: 7.1, 7.2, 7.3_

- [ ] 9. 統合とエンドツーエンドテスト
  - [ ] 9.1 アプリケーション起動時のアップデートチェック統合
    - 起動時の自動チェック機能を統合
    - 非同期処理の実装
    - _要件: 1.1, 1.3, 1.4_

  - [ ]* 9.2 起動時アップデートチェックの単体テスト
    - 起動時の動作確認
    - ネットワーク接続なし時の動作確認
    - _要件: 1.1, 1.3_

- [ ] 10. 最終チェックポイント - 全機能の統合確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば尋ねる

## 注意事項

- `*`マークの付いたタスクはオプションで、より迅速なMVPのためにスキップ可能
- 各タスクは特定の要件への追跡可能性を持つ
- チェックポイントで段階的な検証を実施
- プロパティテストは普遍的な正確性プロパティを検証
- 単体テストは特定の例とエッジケースを検証