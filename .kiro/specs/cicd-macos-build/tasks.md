# 実装計画

## クロスプラットフォームCI/CDパイプライン実装計画

- [x] 1. 環境設定とデータベース分離機能の実装
  - 環境判定ロジックの作成
  - データベースファイル名の環境別管理
  - 既存のデータベース接続コードの更新
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 1.1 環境設定モジュールの作成
  - `src-tauri/src/config/environment.rs`ファイルを作成
  - Environment列挙型とget_environment関数を実装
  - get_database_filename関数を実装
  - _要件: 3.1, 3.2_

- [ ]* 1.2 環境に応じたデータベースファイル選択のプロパティテスト
  - **プロパティ5: 環境に応じたデータベースファイル選択**
  - **検証対象: 要件 4.1, 4.2**

- [x] 1.3 データベース接続コードの更新
  - `src-tauri/src/db/connection.rs`を更新
  - 環境設定モジュールを使用してデータベースファイル名を決定
  - get_db_path関数を環境対応に更新
  - _要件: 4.3, 4.4_

- [ ]* 1.4 データベースファイル自動作成のプロパティテスト
  - **プロパティ7: データベースファイル自動作成**
  - **検証対象: 要件 4.4**

- [ ]* 1.5 環境切り替え時パス自動選択のプロパティテスト
  - **プロパティ6: 環境切り替え時パス自動選択**
  - **検証対象: 要件 4.3**

- [x] 2. クロスプラットフォームGitHub Actionsワークフローの更新
  - CI/CDパイプラインをクロスプラットフォーム対応に拡張
  - MacOSとWindowsランナーでの並行ビルド環境セットアップ
  - 依存関係管理とキャッシュ設定の統一
  - _要件: 1.1, 1.2, 1.3, 5.1, 5.4, 5.5_

- [x] 2.1 GitHub Actionsワークフローファイルの更新
  - `.github/workflows/release.yml`をクロスプラットフォーム対応に更新
  - MacOSとWindowsの並行ビルドジョブを追加
  - リリースジョブの依存関係設定
  - _要件: 1.1, 1.2, 1.3_

- [x] 2.2 MacOSビルドジョブの実装
  - MacOSランナー環境の設定
  - pnpm環境セットアップとフロントエンドビルド
  - Tauriビルドとdmgファイル生成
  - _要件: 1.2, 5.1_

- [x] 2.3 Windowsビルドジョブの実装
  - Windowsランナー環境の設定
  - pnpm環境セットアップとフロントエンドビルド
  - Tauriビルドとmsiファイル生成
  - _要件: 1.3, 5.1_

- [ ]* 2.4 固定依存関係使用のプロパティテスト
  - **プロパティ8: 固定依存関係使用**
  - **検証対象: 要件 5.1**

- [ ]* 2.5 クロスプラットフォーム依存関係管理のプロパティテスト
  - **プロパティ11: クロスプラットフォーム依存関係管理**
  - **検証対象: 要件 5.5**

- [ ] 3. クロスプラットフォームTauriビルドプロセスの実装
  - プロダクションビルド設定の最適化
  - dmgとmsiファイル生成の設定
  - クロスプラットフォームアプリケーション署名の設定
  - _要件: 1.2, 1.3, 2.2, 3.2, 5.2_

- [ ] 3.1 Tauri設定ファイルのクロスプラットフォーム対応
  - `src-tauri/tauri.conf.json`をクロスプラットフォーム対応に更新
  - MacOS用dmgとWindows用msiのバンドル設定
  - プラットフォーム固有のアイコンとメタデータ設定
  - _要件: 1.2, 1.3_

- [ ] 3.2 クロスプラットフォームビルドコマンドの実装
  - GitHub ActionsでのMacOSとWindowsビルド
  - プラットフォーム固有のTauriビルドプロセス
  - dmgとmsiファイル生成プロセス
  - _要件: 1.2, 1.3, 5.2_

- [ ]* 3.3 クロスプラットフォーム成果物生成のプロパティテスト
  - **プロパティ1: クロスプラットフォーム成果物生成**
  - **検証対象: 要件 1.2, 1.3, 1.5**

- [ ]* 3.4 ビルド再現性のプロパティテスト
  - **プロパティ9: ビルド再現性**
  - **検証対象: 要件 5.2**

- [ ] 4. クロスプラットフォームエラーハンドリングとログ機能の実装
  - 両プラットフォームでのビルド失敗時詳細ログ出力
  - 適切なエラーメッセージの表示
  - 通知機能の実装
  - _要件: 1.4, 5.3, 6.5_

- [ ] 4.1 クロスプラットフォームビルドエラーハンドリングの実装
  - MacOSとWindowsビルドでのエラーキャッチ
  - プラットフォーム固有の詳細ログ出力設定
  - ビルド失敗時の統一通知設定
  - _要件: 1.4, 5.3_

- [ ]* 4.2 ビルド失敗時エラーハンドリングのプロパティテスト
  - **プロパティ2: ビルド失敗時エラーハンドリング**
  - **検証対象: 要件 1.4, 5.3**

- [ ]* 4.3 新コミット時ビルド状態クリアのプロパティテスト
  - **プロパティ10: 新コミット時ビルド状態クリア**
  - **検証対象: 要件 5.4**

- [ ]* 4.4 ビルド失敗時リリース中止のプロパティテスト
  - **プロパティ15: ビルド失敗時リリース中止**
  - **検証対象: 要件 6.5**

- [ ] 5. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があれば質問する

- [ ] 6. クロスプラットフォームGitHubリリース自動化の実装
  - リリース作成の自動化
  - dmgとmsiファイルの両方のアセット添付
  - リリースノートの自動生成
  - _要件: 6.1, 6.2, 6.3_

- [ ] 6.1 クロスプラットフォームGitHubリリース作成の実装
  - バージョンタグの自動生成
  - GitHubリリースの作成（両ビルド完了後）
  - dmgとmsiファイルの両方をリリースアセット添付
  - _要件: 6.1, 6.2_

- [ ] 6.2 リリースノート自動生成の実装
  - コミットメッセージからのリリースノート生成
  - クロスプラットフォーム対応のリリースノートフォーマット設定
  - _要件: 6.3_

- [ ]* 6.3 クロスプラットフォームリリースアセット添付のプロパティテスト
  - **プロパティ12: クロスプラットフォームリリースアセット添付**
  - **検証対象: 要件 6.2**

- [ ]* 6.4 リリースノート自動生成のプロパティテスト
  - **プロパティ13: リリースノート自動生成**
  - **検証対象: 要件 6.3**

- [ ] 7. 通知機能の実装
  - クロスプラットフォームリリース完了通知の設定
  - 関係者への通知機能
  - _要件: 6.4_

- [ ] 7.1 リリース完了通知の実装
  - GitHub Actionsでのクロスプラットフォーム通知設定
  - 関係者への統一通知機能
  - _要件: 6.4_

- [ ]* 7.2 リリース完了通知のプロパティテスト
  - **プロパティ14: リリース完了通知**
  - **検証対象: 要件 6.4**

- [x] 8. クロスプラットフォームアプリケーション初期化機能の実装
  - 両プラットフォームでの初回起動時初期化処理
  - プロダクション用データベースの初期化
  - プラットフォーム固有のアプリケーションデータディレクトリ作成
  - _要件: 2.4, 3.4_

- [x] 8.1 クロスプラットフォーム初回起動時初期化の実装
  - MacOSとWindowsでのアプリケーション起動時初期化チェック
  - プラットフォーム固有のプロダクション用データベース初期化
  - OS固有のアプリケーションデータディレクトリ作成
  - _要件: 2.4, 3.4_

- [ ]* 8.2 初回起動時初期化のプロパティテスト
  - **プロパティ4: 初回起動時初期化**
  - **検証対象: 要件 2.4, 3.4**

- [ ] 9. クロスプラットフォーム署名とセキュリティ機能の実装
  - MacOSとWindowsでのアプリケーション署名設定
  - 両プラットフォームでの署名済み実行可能ファイル検証
  - _要件: 2.2, 3.2_

- [ ] 9.1 クロスプラットフォームアプリケーション署名の設定
  - macOS用のコード署名設定
  - Windows用のコード署名設定
  - プラットフォーム固有の署名証明書設定
  - _要件: 2.2, 3.2_

- [ ]* 9.2 署名済み実行可能ファイル提供のプロパティテスト
  - **プロパティ3: 署名済み実行可能ファイル提供**
  - **検証対象: 要件 2.2, 3.2**

- [ ] 10. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があれば質問する