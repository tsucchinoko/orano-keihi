# 要件定義書

## 概要

GitHubのmainブランチにマージされた際に、MacOS向けのdmgファイルとWindows向けのmsiファイルを自動的にビルドし、ダウンロード可能な成果物として提供するクロスプラットフォームCI/CDパイプラインを構築する。また、プロダクション環境と開発環境でデータベースファイルが競合しないよう適切に分離する。

## 用語集

- **CI/CDパイプライン**: 継続的インテグレーション・継続的デプロイメントの自動化システム
- **GitHub Actions**: GitHubが提供するCI/CDサービス
- **dmgファイル**: MacOS用のディスクイメージファイル形式
- **msiファイル**: Windows用のMicrosoft Installerパッケージファイル形式
- **Tauri**: RustとWebテクノロジーを使用したデスクトップアプリケーションフレームワーク
- **成果物（Artifact）**: ビルドプロセスで生成されるファイル
- **データベース分離**: 開発環境とプロダクション環境で異なるデータベースファイルを使用すること
- **クロスプラットフォームビルド**: 複数のオペレーティングシステム向けに同時にアプリケーションをビルドすること

## 要件

### 要件1

**ユーザーストーリー:** 開発者として、mainブランチにマージした際に自動的にMacOSとWindows向けのビルドが並行実行されることを望む。これにより、手動でのビルド作業を削減し、一貫性のあるクロスプラットフォームリリースプロセスを確立したい。

#### 受け入れ基準

1. WHEN 開発者がmainブランチにプルリクエストをマージする THEN システムは自動的にMacOSとWindows向けのビルドプロセスを並行して開始する
2. WHEN MacOSビルドプロセスが成功する THEN システムはdmgファイルを生成し、GitHub Actionsの成果物として保存する
3. WHEN Windowsビルドプロセスが成功する THEN システムはmsiファイルを生成し、GitHub Actionsの成果物として保存する
4. WHEN いずれかのビルドプロセスが失敗する THEN システムは適切なエラーメッセージを表示し、開発者に通知する
5. WHEN すべてのビルドが完了する THEN システムは生成されたdmgファイルとmsiファイルをダウンロード可能な状態で提供する

### 要件2

**ユーザーストーリー:** MacOSユーザーとして、GitHubから最新のMacOSアプリケーションを簡単にダウンロードして利用したい。これにより、複雑なビルド手順を経ることなく、すぐにアプリケーションを使い始めることができる。

#### 受け入れ基準

1. WHEN MacOSユーザーがGitHubのリリースページにアクセスする THEN システムは最新のdmgファイルをダウンロードリンクとして表示する
2. WHEN MacOSユーザーがdmgファイルをダウンロードする THEN システムは署名済みの実行可能なアプリケーションを提供する
3. WHEN MacOSユーザーがdmgファイルをマウントする THEN システムは標準的なMacOSインストール体験を提供する
4. WHEN MacOSアプリケーションが初回起動される THEN システムは適切なアプリケーションデータディレクトリを作成し、プロダクション用データベースを初期化する

### 要件3

**ユーザーストーリー:** Windowsユーザーとして、GitHubから最新のWindowsアプリケーションを簡単にダウンロードして利用したい。これにより、複雑なビルド手順を経ることなく、すぐにアプリケーションを使い始めることができる。

#### 受け入れ基準

1. WHEN WindowsユーザーがGitHubのリリースページにアクセスする THEN システムは最新のmsiファイルをダウンロードリンクとして表示する
2. WHEN Windowsユーザーがmsiファイルをダウンロードする THEN システムは署名済みの実行可能なアプリケーションを提供する
3. WHEN Windowsユーザーがmsiファイルを実行する THEN システムは標準的なWindowsインストール体験を提供する
4. WHEN Windowsアプリケーションが初回起動される THEN システムは適切なアプリケーションデータディレクトリを作成し、プロダクション用データベースを初期化する

### 要件4

**ユーザーストーリー:** 開発者として、開発環境とプロダクション環境でデータベースファイルが競合しないことを確実にしたい。これにより、開発中のテストデータがプロダクション環境に影響を与えることを防ぎたい。

#### 受け入れ基準

1. WHEN アプリケーションが開発モードで実行される THEN システムは開発用のデータベースファイル名を使用する
2. WHEN アプリケーションがプロダクションモードで実行される THEN システムはプロダクション用のデータベースファイル名を使用する
3. WHEN 環境が切り替わる THEN システムは適切なデータベースファイルパスを自動的に選択する
4. WHEN データベースファイルが存在しない THEN システムは環境に応じた適切な場所に新しいデータベースファイルを作成する

### 要件5

**ユーザーストーリー:** 開発チームとして、クロスプラットフォームビルドプロセスが確実で再現可能であることを確保したい。これにより、異なる環境でも一貫したビルド結果を得ることができる。

#### 受け入れ基準

1. WHEN MacOSまたはWindowsビルドプロセスが実行される THEN システムは固定されたバージョンの依存関係を使用する
2. WHEN ビルド環境が変更される THEN システムは同じ入力に対して同じ出力を生成する
3. WHEN いずれかのプラットフォームでビルドが失敗する THEN システムは詳細なログ情報を提供し、問題の特定を支援する
4. WHEN 新しいコミットがプッシュされる THEN システムは前回のビルド状態をクリアして新しいビルドを開始する
5. WHEN 複数のプラットフォームでビルドが実行される THEN システムは各プラットフォーム固有の依存関係を適切に管理する

### 要件6

**ユーザーストーリー:** プロジェクトメンテナーとして、クロスプラットフォームリリースプロセスを自動化し、手動での介入を最小限に抑えたい。これにより、リリースの頻度を向上させ、人的エラーを削減したい。

#### 受け入れ基準

1. WHEN mainブランチにマージが完了する THEN システムは自動的にバージョンタグを作成し、GitHubリリースを生成する
2. WHEN リリースが作成される THEN システムは生成されたdmgファイルとmsiファイルの両方をリリースアセットとして添付する
3. WHEN リリースノートが必要な場合 THEN システムは最新のコミットメッセージから自動的にリリースノートを生成する
4. WHEN リリースプロセスが完了する THEN システムは関係者に通知を送信する
5. WHEN いずれかのプラットフォームでビルドが失敗する THEN システムはリリース作成を中止し、エラー詳細を報告する